<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.92.2" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>David Saltares &middot; Engineering Leadership &amp; Software Development</title>

  
  <link rel="stylesheet" href="../../css/poole.css">
  <link rel="stylesheet" href="../../css/hyde.css">
  <link rel="stylesheet" href="../../css/poole-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-x.css">
  <link rel="stylesheet" href="../../css/highlight/github-dark-dimmed.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../touch-icon-144-precomposed.png">
  <link href="../../img/favicon.png" rel="icon">

  
  
  
  <link href="%7balternate%20%7bRSS%20application/rss&#43;xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20https://saltares.com/index.xml%7d" rel="alternate" type="application/rss+xml" title="David Saltares &middot; David Saltares" />

  <meta name="description" content="I am David and I write about engineering leadership, remote teams, software development and games development.">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-4440744-3', 'auto');
    ga('send', 'pageview');
  </script>
  

  

  
  <link rel="canonical" href="https://saltares.com/" itemprop="url" />
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="../../"><img src="../../img/profile.jpg"
             alt="profile-picture" id="profile-img" title="David Saltares"></a>
      <h1><a href="../../">David Saltares</a></h1>
      <p class="lead">Engineering Leadership &amp; Software Development</p>
      <div class="subscribe"><a href="https://tinyletter.com/dsaltares/">✉️ Subscribe</a></div>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="../../">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="../../about">About</a></li>
      
      <li class="sidebar-nav-item"><a href="../../apps-tools">Apps &amp; Tools</a></li>
      
      <li class="sidebar-nav-item"><a href="../../game-jams">Game Jams</a></li>
      
      <li class="sidebar-nav-item"><a href="../../games">Games</a></li>
      
      <li class="sidebar-nav-item"><a href="../../libgdx-cross-platform-game-development-cookbook">Libgdx Cookbook</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a aria-label="Github profile" href="http://github.com/dsaltares"><i class="fa fa-github-square fa-2x"></i></a>
      
      
      <a aria-label="LinkedIn profile" href="https://www.linkedin.com/in/davidsaltares"><i class="fa fa-linkedin-square fa-2x"></i></a>
      
      
      <a aria-label="Twitter profile" href="http://twitter.com/d_saltares"><i class="fa fa-twitter-square fa-2x"></i></a>
      
      <a aria-label="RSS" href="../../index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-2x"></i></a>
      </li>
    </ul>

    

    <div class="copyright">
      <p>&copy; 2022 David Saltares.</p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/sistema-de-busqueda-de-caminos/">Sistema de búsqueda de caminos</a>
      </h1>
      <span class="post-date">Apr 5, 2011 &middot; 4 minute read &middot; <a href="https://saltares.com/games/sistema-de-busqueda-de-caminos/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>
  <img src="../../img/wp/titulo-navmesh.png" alt="titulo-navmesh.png">

</p>
<p>Hace unos días publicaba un <a href="../../proyectos/pfc/sion-tower/sion-tower-navigation-mesh-y-a/" title="Sion Tower, navigation mesh y A*">vídeo</a> mostrando el <strong>sistema de búsqueda de caminos empleando mallas de navegación</strong> y el algoritmo A estrella para Sion Tower. Pudisteis ver que el personaje recorría el camino de forma brusca, actualmente el problema se ha solucionado gracias a la <strong>inclusión de splines en una colaboración</strong> del compañero <a href="http://ragingbit.com/blog/">Javier Santacruz</a> (<a href="http://twitter.com/#!/arld101">@arld101</a>). ¡La primera colaboración en forma de código! En este artículo nos centraremos en ilustrar a grandes rasgos <strong>como funciona la búsqueda</strong> de caminos internamente.</p>
<h3 id="conceptos-generales">Conceptos generales</h3>
<p>El problema inicial era la <strong>necesidad de que los enemigos pudiesen moverse</strong> por el escenario hacia un objetivo evitando los obstáculos estáticos. El ejemplo más común sería el de perseguir al protagonista para atacarle. Para ello es necesario definir las zonas transitables de alguna manera y la respuesta es emplear una malla de navegación.</p>
<p>En <a href="http://www.blender.org/">Blender</a> se crea una <strong>malla compuesta de triángulos interconectados</strong> tal y como se ilustra en la imagen que ya he mostrado en alguna ocasión. El sistema de carga de niveles procesa la malla y genera un grafo de forma interna. Realizar búsqueda de caminos dentro del grafo es un problema conocido y relativamente sencillo de resolver como veremos más adelante. Además el sistema soporta celdas con inclinación (como en las escaleras) aunque al algoritmo esto le es indiferente.</p>
<p>
  <img src="../../img/wp/blender-navmesh.jpg" alt="blender-navmesh.jpg">

</p>
<h3 id="clases-implicadas">Clases implicadas</h3>
<p>El sistema de búsqueda de caminos de Sion Tower está compuesto por las clases del siguiente diagrama:</p>
<p>
  <img src="../../img/wp/clases-navmesh.png" alt="clases-navmesh.png">

</p>
<ul>
<li><em>Cell</em>: representa una celda triangular de la malla.*   <em>NavigationMesh</em>: malla de navegación formada por un grafo de <em>Cells</em>. Permite localizar elementos en celdas de la malla, conocer la altura a la que debe colocarse un personaje para pegarlo al suelo, realizar consultas de línea de visión y búsqueda de caminos.*   <em>CellNode</em>: nodo de la búsqueda de caminos. Tiene asociado una <em>Cell</em>, y los costes de la heurística.*   <em>Level</em>: ya hablamos de ella en <a href="../../proyectos/pfc/sion-tower/creacion-de-escenarios-en-formato-dotscene-con-blender/" title="Creación de escenarios en formato DotScene con Blender">otra ocasión</a>. Se encarga de cargar y almacenar la información de los niveles desde ficheros en formato XML. Entre la información del nivel, carga un <em>NavigationMesh</em>.</li>
</ul>
<h3 id="algoritmo-a">Algoritmo A*</h3>
<p>El <strong><a href="http://en.wikipedia.org/wiki/A*_search_algorithm">algoritmo A*</a></strong> es de sobra conocido por muchos y puede obtenerse mucha información sobre el mismo en decenas de fuentes. En la búsqueda de Sion Tower le indicamos una posición de comienzo y una de destino al método <em>buildPath</em> de <em>NavigationMesh</em> y se nos devuelve una lista de puntos por los que hay que pasar. De forma esquematizada <strong>se hace lo siguiente</strong>:</p>
<ol>
<li>Encontrar las celdas en las que se encuentran las posiciones de inicio y destino</li>
<li>Crear un <a href="http://en.wikipedia.org/wiki/Heap_(data_structure)">montículo</a> con un <em>CellNode</em> asociado a la primera celda.</li>
<li>Bucle:
<ol>
<li>Sacar el nodo más prometedor del montículo.</li>
<li>Si el nodo corresponde a la celda final, hemos terminado.</li>
<li>Introducimos en el montículo los nodos cuyas celdas son vecinas a las del nodo actual.</li>
<li>Comenzar de nuevo el paso 3.</li>
</ol>
</li>
<li>Reconstruir el camino de puntos empleando un spline para evitar cambios bruscos.</li>
</ol>
<h3 id="colaboración-para-suavizar-el-camino">Colaboración para suavizar el camino</h3>
<p>El compañero Francisco Javier Santacruz se interesó en suavizar la ruta resultante de la búsqueda y rápidamente se puso manos a la obra. Tras un par de días de trabajo me envió un parche que apliqué gustosamente por sus <strong>impresionantes resultados</strong>.</p>
<p>La forma de suavizar la ruta consiste en generar muchos puntos intermedios <strong>siguiendo un <a href="http://es.wikipedia.org/wiki/Spline">spline</a></strong>. Los splines son curvas definidas mediante polinomios: ¡por fin las clases de Métodos Numéricos sirven para algo! En el caso que nos ocupa utilizó el <a href="http://en.wikipedia.org/wiki/Cubic_Hermite_spline#Catmull.E2.80.93Rom_spline">spline de Catmull-Roll</a>, un tipo de interpolación cúbica. En la prueba que me mandó se visualizaba la ruta del personaje ya suavizada como una línea en el suelo dibujada con primitivas de Ogre. Simplemente restan por hacer unos pequeños ajustes, <strong>¡muchas gracias!</strong></p>
<p>
  <img src="../../img/wp/siontower-navmesh.jpg" alt="siontower-navmesh.jpg">

</p>
<h3 id="conclusiones">Conclusiones</h3>
<p>Implementar el sistema de búsqueda de caminos con una malla de navegación <strong>ha sido muy enriquecedor</strong> ya que era una materia completamente desconocida por mí hasta el momento. He aprendido mucho sobre las distintas aproximaciones existentes y la forma de aplicarla a un juego tridimensional. Además he obtenido la primera colaboración en términos de código a través de un parche. Los que estéis interesados en los detalles podéis acudir a <a href="https://forja.rediris.es/plugins/scmsvn/viewcvs.php/siontower/branches/navmesh-javi/?root=cusl5-iberogre">la rama correspondiente de la forja</a>.</p>
<p>¡Seguiré informando!</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/colisiones-y-fisica-con-ogrebullet-en-iberogre/">Colisiones y física con OgreBullet en IberOgre</a>
      </h1>
      <span class="post-date">Apr 4, 2011 &middot; 1 minute read &middot; <a href="https://saltares.com/games/colisiones-y-fisica-con-ogrebullet-en-iberogre/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>
  <img src="../../img/wp/bullet_logo.png" alt="bullet_logo.png">

</p>
<p><strong>Vuelve la actividad a la wiki de Ogre en español</strong> gracias a Alberto Cejas Sánchez. El compañero responsable del proyecto <em><a href="http://futbolesasi.wordpress.com/">Fútbol es Así</a></em> estaba trabajando en la detección de colisiones para su videojuego y finalmente decidió utilizar el wrapper de <a href="http://bulletphysics.org/wordpress/">Bullet</a> para Ogre. Tras dar los primeros pasos ha publicado <strong><a href="http://osl2.uca.es/iberogre/index.php/Colisiones_y_F%C3%ADsicas_con_OgreBullet">&ldquo;Colisiones y físicas con OgreBullet&rdquo;</a></strong>. Por el momento ha publicado la instalación en GNU/Linux (de la que no existía apenas información) y Windows, más adelante irá completando el artículo. Muchísimas gracias a Alberto por su nueva colaboración.</p>
<p>
  <img src="../../img/wp/gtaiv.jpg" alt="gtaiv.jpg">

</p>
<p>Bullet es una de las bibliotecas libres (licencia zlib) de <strong>detección de colisiones y simulaciones físicas</strong> más potentes que existe. Por su extrema capacidad me pareció excesivo utilizarlo en Sion Tower ya que no requería interacciones físicas. No obstante, cualquier interesado en incorporar este elemento en su videojuego debería considerar utilizar Bullet. Entre sus <strong>características</strong> se encuentran:</p>
<ul>
<li>Colisiones entre cuerpos rígidos y blandos de forma discreta o continua.*   Varias formas básicas: esferas, cajas, cilindros, conos, poliedro convexos, etc.*   Simulación de ropa, cuerdas y objetos deformables.*   Restricciones para cuerpos más realistas.</li>
</ul>
<p>Bullet se ha <strong>utilizado en decenas de proyectos</strong> de renombre como Blender, Cinema 4D, Grand Theft Auto IV o Trials HD. En el siguiente vídeo podéis ver un pequeño ejemplo del potencial de la biblioteca.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://player.vimeo.com/video/14626222" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</div>


      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/memoria-para-el-v-cusl/">Memoria para el V CUSL</a>
      </h1>
      <span class="post-date">Apr 3, 2011 &middot; 1 minute read &middot; <a href="https://saltares.com/games/memoria-para-el-v-cusl/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>
  <img src="../../img/wp/cusl.png" alt="cusl.png">

</p>
<p>Este año la normativa del Concurso Universitario de Software Libre exige que se presente una memoria por proyecto para facilitar la evaluación de los mismos a los miembros del jurado. Este fin de semana no he podido desarrollar demasiado ya que he estado recopilando información para redactar dicha memoria. Aún así tengo novedades muy interesantes que iré publicando estos días.</p>
<ul>
<li><a href="../../docs/memoria-cusl.pdf">Descargar memoria de IberOgre y Sion Tower para el V CUSL</a></li>
</ul>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/sion-tower-navigation-mesh-y-a/">Sion Tower, navigation mesh y A*</a>
      </h1>
      <span class="post-date">Apr 1, 2011 &middot; 2 minute read &middot; <a href="https://saltares.com/games/sion-tower-navigation-mesh-y-a/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <div
  style="position: relative; padding-bottom: 62.5%; height: 0; margin-bottom: 1em;">
  <iframe
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
    src="https://www.youtube.com/embed/2Q2tJxcTqoE"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
  >
  </iframe>
</div>

<p>En este nuevo vídeo podemos ver el <strong>sistema de búsqueda de caminos</strong> empleando el conocido <strong><a href="http://en.wikipedia.org/wiki/A*_search_algorithm">algoritmo A*</a></strong> junto a una malla de triángulos diseñada con <a href="http://www.blender.org/">Blender</a>. Es una sencilla demostración en la que el usuario mueve el marcador verde, pulsa la barra espaciadora y el personaje se dirige automáticamente al punto indicado por dicho marcador. Este sistema se integrará dentro del <strong>comportamiento de los enemigos</strong> de Sion Tower.</p>
<p>El sistema está <strong>orientado a la optimización del flujo de trabajo</strong> y permite que los diseñadores puedan definir desde Blender las zonas del mapa que serán transitables por los enemigos:</p>
<ol>
<li>Creación de una malla de triángulos</li>
<li>Exportación de la malla a formato <em>.mesh</em> (Ogre)</li>
<li>Exportación del nivel completo en <em>DotScene</em> (incluyendo la malla)</li>
<li>Carga del escenario en el motor del juego</li>
</ol>
<p>
  <img src="../../img/wp/navigationMesh2.png" alt="navigationMesh2.png">

</p>
<p>Sobra decir que aún <strong>queda un gran espacio para la mejora</strong>. Actualmente el sistema nos devuelve la lista de celdas que componen el camino hacia el destino indicado. Posteriormente, el personaje recorre los puntos centrales de las celdas cambiando su orientación de forma brusca. La única optimización implementada consiste en tratar de saltar todas las celdas intermedias posibles siempre que haya una línea recta transitable entre el origen y el destino.</p>
<p>En posteriores artículos ofreceré documentación adicional sobre el diseño y el funcionamiento interno del sistema. ¡Hay tanto trabajo por hacer!</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/musica-de-victoria-y-derrota-en-sion-tower/">Música de victoria y derrota en Sion Tower</a>
      </h1>
      <span class="post-date">Mar 30, 2011 &middot; 1 minute read &middot; <a href="https://saltares.com/games/musica-de-victoria-y-derrota-en-sion-tower/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>
  <img src="../../img/wp/estudio-evergreen.jpg" alt="estudio-evergreen.jpg">

</p>
<p>Los chicos del <strong><a href="http://estudioevergreen.wordpress.com/">Estudio Evergreen</a></strong> (<a href="http://twitter.com/#!/Hempfreud">Antonio Caro</a> y <a href="http://twitter.com/#!/Danpelgar">Daniel Pellicer</a>) <strong>siguen componiendo piezas para la banda sonora</strong> del juego a un ritmo envidiable. Recientemente colgaron en su blog dos nuevas melodías, las que sonarían durante al finalizar con éxito un nivel o al morir en el intento. A continuación podréis escucharlas.</p>
<ul>
<li><strong>Victoria</strong>: una canción alegre que se reproducirá en conjunción con la animación de celebración del protagonista. Se compone de dos partes: la primera es más intensa mientras que la segunda es más relajada y se reproduce en un bucle. Está pensado para que el jugador pueda pasar el tiempo que desee en la pantalla que muestra las habilidades adquiridas y los puntos conseguidos en cada nivel.</li>
</ul>
<audio controls>
    <source src='../../audio/sion-tower-victory-theme.mp3' />
</audio>
<ul>
<li><strong>Derrota</strong>: mezcla una melodía de órgano bastante siniestra con puntos cómicos como unos platillos o animales graznando. Está pensada para que el usuario sea consciente de que ha perdido restándole importancia al fracaso y animando a que reintente la jugada.</li>
</ul>
<audio controls>
    <source src='../../audio/sion-tower-defeat.ogg' />
</audio>
<p>Recomiendo encarecidamente que leáis los <a href="http://estudioevergreen.wordpress.com/2011/03/15/%c2%a1victoria/">artículos de su blog</a> en los que explican de forma más razonada los motivos que les llevan a componer estas piezas de una manera en concreto. Como ya he mencionado en artículos anteriores, el arte de Sion Tower es libre bajo <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons 3.0 by-nc-sa</a>.</p>

      
    </div>
    
        <div class=pagination>
        <ul class="pagination">
            <li>
                <a href="../../">««</a>
            </li>
            
            <li>
                <a href="../../page/39/">«</a>
            </li>
            
            <li class="active">
                <a href="../../page/40/">40</a>
            </li>
            
            <li>
                <a href="../../page/41/">»</a>
            </li>
            
            <li>
                <a href="../../page/63/">»»</a>
            </li>
        </ul>
    </div>
  </div>
</div>


<script type="text/javascript">
var disqus_shortname = "siondream";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>


<script src="../../js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
<script src="../../js/load-photoswipe.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
</body>
</html>

