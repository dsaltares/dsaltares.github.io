<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.93.0" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>David Saltares &middot; Engineering Leadership &amp; Software Development</title>

  
  <link rel="stylesheet" href="../../css/poole.css">
  <link rel="stylesheet" href="../../css/hyde.css">
  <link rel="stylesheet" href="../../css/poole-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-x.css">
  <link rel="stylesheet" href="../../css/highlight/github-dark-dimmed.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../touch-icon-144-precomposed.png">
  <link href="../../img/favicon.png" rel="icon">

  
  
  
  <link href="%7balternate%20%7bRSS%20application/rss&#43;xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20https://saltares.com/index.xml%7d" rel="alternate" type="application/rss+xml" title="David Saltares &middot; David Saltares" />

  <meta name="description" content="I am David and I write about engineering leadership, remote teams, software development and games development.">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-4440744-3', 'auto');
    ga('send', 'pageview');
  </script>
  

  

  
  <link rel="canonical" href="https://saltares.com/" itemprop="url" />
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="../../"><img src="../../img/profile.jpg"
             alt="profile-picture" id="profile-img" title="David Saltares"></a>
      <h1><a href="../../">David Saltares</a></h1>
      <p class="lead">Engineering Leadership &amp; Software Development</p>
      <div class="subscribe"><a href="https://tinyletter.com/dsaltares/">✉️ Subscribe</a></div>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="../../">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="../../about">About</a></li>
      
      <li class="sidebar-nav-item"><a href="../../apps-tools">Apps &amp; Tools</a></li>
      
      <li class="sidebar-nav-item"><a href="../../game-jams">Game Jams</a></li>
      
      <li class="sidebar-nav-item"><a href="../../games">Games</a></li>
      
      <li class="sidebar-nav-item"><a href="../../libgdx-cross-platform-game-development-cookbook">Libgdx Cookbook</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a aria-label="Github profile" href="http://github.com/dsaltares"><i class="fa fa-github-square fa-2x"></i></a>
      
      
      <a aria-label="LinkedIn profile" href="https://www.linkedin.com/in/davidsaltares"><i class="fa fa-linkedin-square fa-2x"></i></a>
      
      
      <a aria-label="Twitter profile" href="http://twitter.com/d_saltares"><i class="fa fa-twitter-square fa-2x"></i></a>
      
      <a aria-label="RSS" href="../../index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-2x"></i></a>
      </li>
    </ul>

    

    <div class="copyright">
      <p>&copy; 2022 David Saltares.</p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/computing/listenerset-using-variadic-templates/">ListenerSet using variadic templates</a>
      </h1>
      <span class="post-date">Apr 24, 2014 &middot; 5 minute read &middot; <a href="https://saltares.com/computing/listenerset-using-variadic-templates/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/computing">Computing</a>
      </span>
      
      <p><strong>Important</strong>: variadic templates are only available from C++11, make sure your compiler supports it.</p>
<p>Who has never used the <a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer</a> pattern? As long as you have been involved in any medium sized project, chances are you have come across it at some point.</p>
<h3 id="the-problem">The problem</h3>
<p>It is extremely common to have an event generating system other components would like to subscribe to. However, oftentimes I see code to manage a collection of listeners being unnecessarily duplicated on a per system basis. That is registration, un-registration and notification. A lot of nonsensical boilerplate, which makes for code that is harder to read and easier to get wrong.</p>
<p>Let&rsquo;s take a look at a typical input event dispatching system, simplified for the purposes of this article. We could have an <code>IInputListener</code> interface that handles a couple of events, <code>keyDown()</code> and <code>keyUp()</code>.</p>
<pre tabindex="0"><code>struct IInputListener
{
    virtual ~IInputListener() {}
    virtual bool keyDown(KeyCode code) = 0;
    virtual bool keyUp(KeyCode code) = 0;
};
</code></pre><p>Our <code>InputSystem</code> class could hold an <code>std::set</code> of <code>IInputListener</code> pointers. Registration and un-registration is made possible through <code>addListener()</code> and <code>removeListener()</code> respectively. Bad news is that, every single time we want to send an event to the listeners, we are forced to iterate over the collection. Also, God kills a kitten.</p>
<pre tabindex="0"><code>class InputSystem
{
public:
    void addListener(IInputListener* listener)
    {
        m_listeners.insert(listener);
    }

    void removeListener(IInputListener* listener)
    {
        m_listeners.erase(listener);
    }

    void update()
    {
        // Touch down detected
        for (auto listener : m_listeners)
        {
            listener-&gt;keyDown(code);
        }

        ...

        // Touch up detected
        for (auto listener : m_listeners)
        {
            listener-&gt;keyUp(code);
        }
    }

private:
    std::set&lt;IInputListener*&gt; m_listeners;
};
</code></pre><p>As if this wasn&rsquo;t enough, there is another important <em>gotcha</em> here. What happens when a listener un-registers as a result of an event? The <code>m_listeners</code> collection is modified in the middle of the <code>for</code> loop, thus current iterators are no longer valid. The second we try to increment the internal iterator to fetch the next listener.</p>
<blockquote>
<p>BAM!</p>
</blockquote>
<p>Not good.</p>
<p>The solution is simple but annoying. We can just add new listener registration and un-registration requests to a pending list while in the middle of a dispatch. Those pending lists would be processed once it&rsquo;s safe to modify the collection of listeners.</p>
<p>Moreover, some people use <code>std::vector</code> instead of <code>std::set</code> for performance reasons, which is completely legit. However, that involves adding code to ensure listener uniqueness in the collection.</p>
<p>Every time.</p>
<p>Honestly? I&rsquo;m lazy so I don&rsquo;t want to be the guy who implements this over and over.</p>
<blockquote>
<p>Okay, so what do you suggest?</p>
</blockquote>
<h3 id="the-way-towards-the-solution">The way towards the solution</h3>
<p>Following our intuition, we realise that a way to generalise this behaviour is in order. Ideally, it would meet the following criteria.</p>
<ul>
<li>Avoids all code duplication.</li>
<li>Ensures listener uniqueness.</li>
<li>It is safe, can register, un-register while notifying.</li>
<li>Avoids manually going through the listener collection to send an event.</li>
<li>Compatible with any kind of event listener.</li>
</ul>
<p>Intuitively, we could have a <code>ListenerSet&lt;Type&gt;</code> template class that handles listener duplication as well as registration and un-registration safety.</p>
<p><strong>Note</strong>: we&rsquo;ll be using <code>std::set</code> rather than <code>std::vector</code> for simplicity. Both can be used as long as the appropriate precautions are taken.</p>
<pre tabindex="0"><code>template &lt;class Type&gt; class ListenerSet
{
public:
    ListenerSet() {}
    virtual ~ListenerSet() {}

    inline void addListener(Type listener)
    {
        if (m_notifying)
        {
            m_pendingAddition.insert(listener);
            m_pendingRemoval.erase(listener);
        }
        else
        {
            m_listeners.insert(listener);
        }
    }

    inline void removeListener(Type listener)
    {
        if (m_notifying)
        {
            m_pendingRemoval.insert(listener);
            m_pendingAddition.erase(listener);
        }
        else
        {
            m_listeners.erase(listener);
        }
    }

private:
    bool m_notifying;
    std::set&lt;Type&gt; m_pendingRemoval;
    std::set&lt;Type&gt; m_pendingAddition;
    std::set&lt;Type&gt; m_listeners;
};
</code></pre><p>We&rsquo;re missing the notification functionality, that&rsquo;s the tricky part. We would like to have an interface such as to be able to do something like this.</p>
<pre tabindex="0"><code>m_listenerSet.notify(&amp;IInputListener::keyDown, keyCode);
</code></pre><p><code>ListenerSet::notify()</code> would iterate over all the registered listeners calling <code>IInputListener::keyDown</code> and passing <code>keyCode</code> as a parameter.</p>
<blockquote>
<p>Maybe easier said than done?</p>
</blockquote>
<p>True, <code>ListenerSet::notify()</code> needs to support an arbitrary number of arguments, as different event handlers won&rsquo;t necessarily have the same signature. Moreover, <code>IInputListener::keyDown</code>(and every other potential handler) needs to receive a <code>this</code> pointer along the remaining arguments.</p>
<p>This is where <a href="http://www.cplusplus.com/articles/EhvU7k9E/">variadic templates</a> come into play. Basically, they&rsquo;re templates that can take an arbitrary number of parameters of any type.</p>
<p>Interestingly enough, <code>std::bind()</code> also takes an arbitrary number of parameters. That means we can create an <code>std::function&gt;</code> object that has everything we need: the event handler function pointer, <code>this</code> and the remaining arguments.</p>
<p>Take a look at the code.</p>
<pre tabindex="0"><code>template &lt;class Function, class... Arguments&gt;
inline void notify(Function&amp;&amp; f, Arguments&amp;&amp;... args)
{
    m_notifying = true;
    for (Type listener : m_listeners)
    {
        auto callback = std::bind(f, listener, args...);
        callback(listener);
    }
    m_notifying = false;

    for (Type listener : m_pendingRemoval)
    {
        m_listeners.erase(listener);
    }

    m_pendingRemoval.clear();

    for (Type listener : m_pendingAddition)
    {
        m_listeners.insert(listener);
    }

    m_pendingAddition.clear();
}
</code></pre><p>Note how we process the pending requests to add or remove listeners after we finish sending the events, that&rsquo;s when it&rsquo;s safe.</p>
<p>Now we can do exactly what we wanted!</p>
<pre tabindex="0"><code>ListenerSet&lt;IInputListener*&gt; listeners;

listeners.addListener(new PlayerInputListener());
listeners.addListener(new UserInterfaceInputListener());

m_listenerSet.notify(&amp;IInputListener::keyDown, keyCode);
m_listenerSet.notify(&amp;IInputListener::keyUp, keyCode);
</code></pre><p>Templates are instantiated at compile time, which means the compiler will complain if we&rsquo;re doing something dodgy such as trying to bind the wrong thing. Compile time checks are good.</p>
<p>Managing a set of listeners and sending events is now a lot easier, safer and readable. Last but not least, it&rsquo;s significantly less error prone.</p>
<blockquote>
<p>Hooray!!!</p>
</blockquote>
<h3 id="full-source">Full source</h3>
<p>For those interested, I&rsquo;ve made the code available as a GitHub Gist.</p>
<p><a href="https://gist.github.com/dsaltares/11212605">ListenerSet implementation</a></p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/castilla-la-mancha-university-talk/">Castilla: La Mancha University talk</a>
      </h1>
      <span class="post-date">Apr 23, 2014 &middot; 1 minute read &middot; <a href="https://saltares.com/games/castilla-la-mancha-university-talk/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>Oh <code>$deity</code>, it is hard to be back after a 5 day break! Following a healing long weekend in Madrid, yesterday I went over to Ciudad Real to deliver my presentation titled <em>&ldquo;How to break into the Games Industry with Open Source Software&rdquo;</em> at the engineering university school.</p>
<p>I would dare to say it was well received. A zero total count of rotten tomatoes thrown at me shall be good enough of an indicator to back up my previous statement. Or maybe they didn&rsquo;t have any vegetables at hand!</p>
<p>The focus ended up being my experience in the Games Industry, what companies are looking for in graduates and how they can achieve those skills. All of it by using and producing open source software. Oh, I also did some Libgdx preaching!</p>
<p>You&rsquo;re more than welcome to take a look at the talk here although I spoke in Spanish all the time! Scroll down for the slides in English.</p>
<div
  style="position: relative; padding-bottom: 62.5%; height: 0; margin-bottom: 1em;">
  <iframe
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
    src="https://www.youtube.com/embed/A7FO2E5hb6g"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
  >
  </iframe>
</div>

<p>Here&rsquo;s the presentation with and without notes.</p>
<ul>
<li><a href="../../docs/uclm-talk.pdf">How to break into the Games Industry with Open Source Software: notes</a></li>
<li><a href="../../docs/uclm-talk-no-notes.pdf">How to break into the Games Industry with Open Source Software</a></li>
</ul>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/general/talk-at-uclm/">Talk at UCLM</a>
      </h1>
      <span class="post-date">Mar 29, 2014 &middot; 1 minute read &middot; <a href="https://saltares.com/general/talk-at-uclm/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/general">General</a>
      </span>
      
      <p>
  <img src="../../img/wp/uclm-talk.jpg" alt="uclm-talk.jpg">

</p>
<p>Next April 22nd I&rsquo;ll be giving a talk at Castilla: La Mancha University (Spain). I&rsquo;ll be addressing the students enrolled in their <a href="http://www.cursodesarrollovideojuegos.com/">games development course</a> who bother attending to listen to whatever I&rsquo;m going to say.</p>
<p>The talk will focus on how open source projects help you get into the industry, which is something <a href="../../computing/contribute-back-to-open-source-projects/">I&rsquo;ve been writing about lately</a>. But I guess I&rsquo;ll end up talking about tangential matters such as student life as well as my experience at Crytek and Sony.</p>
<p>Anyway! The talk is in less than a month, which means I need to start looking into putting some slides together ASAP. I&rsquo;ll probably post the full presentation once it&rsquo;s been delivered.</p>
<p><strong>Update</strong>: it appears that the whole thing will be filmed and posted on the University YouTube channel (oh, the pressure!). I&rsquo;ll speak in Spanish but I will also post the slides in English separately.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/games/libgdx-is-a-1m-loc-project/">Libgdx has &gt;1M LoC project</a>
      </h1>
      <span class="post-date">Mar 22, 2014 &middot; 1 minute read &middot; <a href="https://saltares.com/games/libgdx-is-a-1m-loc-project/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>Don&rsquo;t exactly remember how, but last night I came across <a href="http://sourceforge.net/projects/codeanalyze-gpl/">Code Analyzer</a>, an open source Java desktop utility that counts lines of code. Out of curiosity, I downloaded the runnable jar file and tried it with Libgdx.</p>
<p>
  <img src="../../img/wp/libgdx-code-stats.png" alt="libgdx-code-stats.png">

</p>
<p>I was very much aware that Libgdx was a pretty big project but certainly didn&rsquo;t expect it to be that large. At the time of writing the <code>HEAD</code> of the repository contains 1.048.646 lines of Java, C and C++. 712.016 of which are actual code, 17% are comments while the rest are just whitespaces.</p>
<p>Not bad, huh?</p>
<p>Although this is obviously not a quality indicator, it shows how big of a baby it is.</p>
<p>There you go, your fun fact of the day.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="https://saltares.com/computing/contribute-back-to-open-source-projects/">Contribute back to open source projects</a>
      </h1>
      <span class="post-date">Mar 14, 2014 &middot; 4 minute read &middot; <a href="https://saltares.com/computing/contribute-back-to-open-source-projects/#disqus_thread">Comments</a>
      
      <br/>
      <a class="label" href="../../categories/computing">Computing</a><a class="label" href="../../categories/games-development">Games development</a>
      </span>
      
      <p>Developers love <a href="https://github.com/libgdx/libgdx">Libgdx</a>, it&rsquo;s an extremely efficient, easy to use, open source, feature rich, cross platform framework. It has a huge community, and a very active repository. What&rsquo;s not to love? The fact that <a href="http://www.appbrain.com/stats/libraries/details/libgdx/libgdx">1.40% apps on AppBrain use Libgdx</a> backs that up.</p>
<p>
  <img src="../../img/wp/libgdx-appbrain-stats.png" alt="libgdx-appbrain-stats.png">

</p>
<p>Have you thought about contributing back?</p>
<blockquote>
<p>Who, me?</p>
</blockquote>
<p>Yes and here&rsquo;s why.</p>
<h3 id="so-much-win">So much win</h3>
<p>The beauty of a healthy community driven project such as Libgdx is that decisions are crowd-sourced and code is always peer reviewed. Although this may feel intimidating, don&rsquo;t let it put you off, take it as the fantastic opportunity to learn that it actually is. The most active developers over there are talented, very talented. That&rsquo;s the kind of people you want to hang out with, just so eventually, you end up absorbing some of their skills.</p>
<p>Personally, that&rsquo;s what I do.</p>
<p>Some <a href="https://github.com/libgdx/libgdx/pull/575">pull requests</a> contain interesting discussions about software design and programming.</p>
<h3 id="low-barrier-of-entry">Low barrier of entry</h3>
<p>Regardless of your level of expertise, there surely is something you can do. From maintaining the documentation to fixing that annoying old bug or introducing a small feature. All contributions are welcome. Actually, even the tiniest thing will bring you closer to the codebase and lead you to a better of understanding of it.</p>
<p>
  <img src="../../img/wp/libgdx-pull-request.png" alt="libgdx-pull-request.png">

</p>
<p><a href="https://github.com/libgdx/libgdx/pull/1335">Everyone makes mistakes</a>, and when that happens, people will politely point it out, giving the contributor a chance to fix it and resubmit. The community is understanding and I haven&rsquo;t seen any attempts to bring shame to anyone.</p>
<p>This is not a League of Legends game.</p>
<p>Unfortunately, <a href="../../computing/dont-be-a-dick-with-the-community/">this is not the case for every project</a>. We&rsquo;re lucky Libgdx is full of love.</p>
<blockquote>
<p>This is all lovely but what&rsquo;s in it for me?</p>
</blockquote>
<p>Portfolio, exposure and recognition.</p>
<h3 id="at-least-do-it-for-yourself">At least, do it for yourself</h3>
<p>Even from a purely selfish standpoint, there are pretty strong reasons to get involved with open source projects. Even more so if you&rsquo;re a student or will be looking for a job in the foreseeable future.</p>
<blockquote>
<p>Yes! I want to get into the industry!</p>
</blockquote>
<p>Sorry to break the bad news for you, once you finish university you&rsquo;ll be out in the wild with thousands of other employment hungry graduates. They tend to complain no one will hire them because of their lack of industry experience. See the vicious circle? Luckily enough, that&rsquo;s nothing more than a bad excuse in the software industry, where the requirements to <em>‘make it yourself&rsquo;</em> are negligible. All it takes is a computer with an Internet connection, which I&rsquo;m pretty sure you already have.</p>
<p>Working on personal projects that you might eventually open source is fantastic and will make you stand out. However, collaborating on a big project with other people reflects so much better on you. Companies need people to jump into projects and get the hang of it ASAP. That involves being comfortable with gigantic codebases written by people you don&rsquo;t know or just met and being able to identify as well as fix the problems within it.</p>
<p>A big open source project gives you that education, for free. Companies will appreciate that enormously.</p>
<blockquote>
<p>I&rsquo;m experienced and looking for a job.</p>
</blockquote>
<p>No doubt other similarly experienced people are seeking similar positions right now. You will compete against them in the hiring process. What&rsquo;s going to set you apart? Exactly, going the extra mile, possibly through open source projects, being active in a community, blogging or public speaking. You get the hang of it.</p>
<h3 id="how-to">How to</h3>
<p>I guess if you&rsquo;ve read this far, we agree to some degree and you might be interested in getting involved.</p>
<p>Good!</p>
<p>In order to start contributing back to Libgdx, it&rsquo;s advisable to read the <em><a href="https://github.com/libgdx/libgdx/wiki/Contributing">Contributing</a></em> wiki page. Later on you should do the following.</p>
<ol>
<li>Clone the repository</li>
<li>Check the <a href="https://github.com/libgdx/libgdx/issues?state=open">issues and feature requests</a> section</li>
<li>Work on it</li>
<li>Send a <a href="https://github.com/libgdx/libgdx/pulls">pull request</a></li>
<li>Rinse and repeat</li>
</ol>
<p>When in doubt, you can always ask in the <a href="http://www.badlogicgames.com/forum/">forums</a> or discuss in the #libgdx IRC channel at <code>irc.freenode.net</code>.</p>
<p>Happy coding!</p>

      
    </div>
    
        <div class=pagination>
        <ul class="pagination">
            <li>
                <a href="../../">««</a>
            </li>
            
            <li>
                <a href="../../page/16/">«</a>
            </li>
            
            <li class="active">
                <a href="../../page/17/">17</a>
            </li>
            
            <li>
                <a href="../../page/18/">»</a>
            </li>
            
            <li>
                <a href="../../page/63/">»»</a>
            </li>
        </ul>
    </div>
  </div>
</div>


<script type="text/javascript">
var disqus_shortname = "siondream";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>


<script src="../../js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
<script src="../../js/load-photoswipe.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
</body>
</html>

