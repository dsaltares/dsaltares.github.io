<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/touch-icon-144-precomposed.png"/><title>Gestión de estados de juego · David Saltares</title><meta name="robots" content="index,follow"/><meta name="description" content="Engineering Leadership &amp; Software Development"/><meta property="og:title" content="Gestión de estados de juego · David Saltares"/><meta property="og:description" content="Engineering Leadership &amp; Software Development"/><meta property="og:url" content="https://saltares.com/gestion-de-estados-de-juego"/><meta property="og:type" content="website"/><link rel="canonical" href="https://saltares.com/gestion-de-estados-de-juego"/><meta name="keywords" content=""/><meta name="next-head-count" content="12"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/d3d4cc303d9c1080.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/d3d4cc303d9c1080.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7671224c423a1e1f.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-66d32731bdd20e83.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-41a9ee3ebe735abe.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-75760b031d352622.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/c16184b3-5eed107b4bbcea31.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/2cca2479-0d4bcd71a6a0316a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/252-2454d8293e83336b.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/167-6fe50976be6d0e53.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/962-ea29c7731d832d32.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/373-f5166c707bca4ed3.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-81b48131ea6e98cc.js" defer="" crossorigin=""></script><script src="/_next/static/UY4b5c_WM5CskI6M1iG7L/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/UY4b5c_WM5CskI6M1iG7L/_ssgManifest.js" defer="" crossorigin=""></script><style data-href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap">@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col md:flex-row font-sans text-xl w-full"><aside class="md:max-w-[360px] bg-primary px-10 py-10 text-white text-xl md:fixed md:top-0 md:left-0 md:h-full flex flex-col justify-end items-center md:items-start"><div><a href="/"><div class="mb-5"><img alt="profile picture" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="rounded-full" style="color:transparent" src="/img/profile.webp"/></div><h1 class="text-white font-bold text-4xl leading-10">David Saltares</h1></a></div><p class="text-contentLight text-2xl mb-5 leading-9 text-center md:text-left">Engineering Leadership &amp; Software Development</p><div class="mb-5 font-base"><button class="ml-onclick-form" onclick="ml('show', '646AL4', true)">✉️ Subscribe</button></div><nav><ul class="mb-5 flex flex-col items-center md:items-start list-none pl-0"><li class="leading-7"><a href="/">Blog</a></li><li class="leading-7"><a href="/about-me/">About</a></li><li class="leading-7"><a href="/apps-tools/">Apps &amp; Tools</a></li><li class="leading-7"><a href="/game-jams/">Game Jams</a></li><li class="leading-7"><a href="/games/">Games</a></li><li class="leading-7"><a href="/libgdx-cross-platform-game-development-cookbook/">Libgdx Cookbook</a></li></ul></nav><ul class="mb-5 list-none pl-0"><li class="inline"><a aria-label="Github profile" href="https://github.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-github" class="svg-inline--fa fa-square-github text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></li><li class="inline"><a aria-label="Linkedin profile" href="https://www.linkedin.com/in/davidsaltares/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="inline"><a aria-label="Twitter profile" href="https://twitter.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-twitter" class="svg-inline--fa fa-square-twitter text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg></a></li><li class="inline"><a aria-label="RSS feed" href="https://saltares.com/index.xml"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path></svg></a></li><li class="inline"><a rel="me" href="https://fosstodon.org/@dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a></li></ul><p class="text-contentLight text-lg">© 2024 David Saltares.</p></aside><div class="md:max-w-[360px] w-full hidden md:block flex-grow-0 flex-shrink-0"></div><div class="flex flex-col main-content"><main class="w-full max-w-[720px] pr-4 py-10 pl-5 md:py-20 md:pl-20"><article class="text-content mb-10"><div><a href="/gestion-de-estados-de-juego/"><h1 class="font-bold text-4xl mb-2 text-primary">Gestión de estados de juego</h1></a><p class="flex text-contentLight mb-1">Apr 6 2011 · 5 min read<span> · </span><a class="text-contentLink" href="/gestion-de-estados-de-juego/#disqus_thread">Comments</a></p><div class="mb-3"><div class="flex flex-row gap-1"><a class="px-2 py-1 bg-slate-900 text-white rounded font-bold text-sm" href="/categories/games-development/">Games development</a></div></div></div><img class="mb-1" src="/img/wp/titulo-statemanager.webp" alt="titulo-statemanager.png"/>
<p><strong>Sion Tower cuenta con varios estados y transiciones</strong> los cuales están especificados en el <a class="text-contentLink text-lg" href="http://forja.rediris.es/frs/download.php/2019/gdd.pdf">Documento de Diseño (GDD)</a> que publiqué hace tiempo. Por supuesto, me refiero a estados como <em>&quot;Juego&quot;</em>, <em>&quot;Menú&quot;</em>, <em>&quot;Selección de nivel&quot;</em>. Me parece interesante comentar a vista de pájaro estos estados así como el sistema subyacente que los gestiona. Puede ser una buena manera para saber hasta dónde pretende llegar el juego. En este artículo hablaremos de las clases <em>State</em> y <em>StateManager</em> entre otras.</p>
<h3>Diagrama de estados</h3>
<p>En el siguiente diagrama se muestran los distintos estados en los que se puede encontrar Sion Tower:</p>
<img class="mb-1" src="/img/wp/flowchart.webp" alt="flowchart.png"/>
<ul>
<li><strong>Menú principal</strong>: se muestra el logo del juego y la torre desde el exterior. El usuario puede elegir entre <em>&quot;Selección de perfil&quot;</em>, <em>&quot;Créditos&quot;</em> o <em>&quot;Salir&quot;</em>.</li>
<li><strong>Créditos</strong>: en la pantalla de créditos se sustituyen las opciones del menú principal por los nombres de los implicados en el desarrollo, como era de esperar. La única opción es volver al menú.</li>
<li><strong>Selección de perfil</strong>: el usuario puede seleccionar su partida entre la lista de partidas guardadas. Así podrá recuperar los niveles desbloqueados y las habilidades adquiridas por el personaje.</li>
<li><strong>Selección de nivel</strong>: se muestra una lista de los niveles disponibles según el perfil elegido. De cada nivel aparece el nombre, una descripción y un icono.</li>
<li><strong>Selección de habilidades</strong>: no es posible utilizar todas las habilidades en cada nivel, el usuario debe seleccionar un número limitado de ellas.</li>
<li><strong>Juego</strong>: la pantalla de juego, donde se desarrolla la acción. Si el usuario vence a los enemigos se pasa a la pantalla de victoria, en caso contrario le aparece un mensaje y se reinicia el nivel.</li>
<li><strong>Fin de nivel</strong>: cuando el usuario vence se muestran los puntos obtenidos y otros logros como haber desbloqueado alguna habilidad nueva.</li>
</ul>
<p>Para detalles adicionales podéis acudir al documento de diseño que incluye bocetos completos de cada uno de los estados.</p>
<h3>Diagrama de clases</h3>
<p>A continuación podéis ver un diagrama UML con las clases que gestionan los estados del juego. Es bastante grande así que lo mejor es hacer click sobre la imagen para ampliarla.</p>
<img class="mb-1" src="/img/wp/statemanager.webp" alt="statemanager.png"/>
<h3>La clase State</h3>
<p><em>State</em> es una clase abstracta que <strong>modela un estado de juego genérico</strong>. Cuenta con los métodos virtuales <em>load</em> y <em>clear</em> para cargar y liberar los elementos que contiene sin necesidad de destruir el estado completamente. Todos los estados poseen un método <em>update</em> que recibe el tiempo en ms desde el último frame (<em>deltaT</em>) para actualizar lógicamente los elementos de dicho estado. Los estados están preparados para recibir los eventos que captura el <em>StateManager</em>, por ello cuenta con los manejadores típicos de la biblioteca OIS (<a class="text-contentLink text-lg" href="http://osl2.uca.es/iberogre/index.php/Manejo_b%C3%A1sico_de_OIS">más sobre OIS en IberOgre</a>).</p>
<p><strong>Por cada estado de juego tendríamos una clase</strong> que herede de <em>State</em> como podrían ser <em>StateGame</em>, <em>StateMenu</em> o <em>StateCredits</em>. Por ejemplo, el estado de juego controlaría al personaje, los enemigos y el escenario. Como podéis ver es un sistema muy genérico y extensible para otros proyectos. De hecho estoy pensando en liberarlo de forma independiente.</p>
<img class="mb-1" src="/img/wp/menu-principal.webp" alt="menu-principal.png"/>
<h3>La clase StateManager</h3>
<p>La clase <em>StateManager</em> lleva internamente una <strong>pila de estados</strong> lo que nos permite volver atrás por los menús del juego de forma muy sencilla. <strong>El tope de la pila sería el estado activo</strong> mientras que el resto pueden estar en pausa o ejecutándose en segundo plano. A través de los metodos <em>changeState</em>, <em>pushState</em>, <em>popState</em> y <em>popAllStates</em> se nos permite gestionar los cambios entre estados. No hay que tener cuidado con el momento en el que se hace un <em>popState</em>, no se destruye ningún estado en ese preciso instante. El <em>StateManager</em> espera a un momento seguro para hacerlo, <strong>no más segmentos violados</strong> en ese aspecto.</p>
<img class="mb-1" src="/img/wp/statestack.webp" alt="statestack.png"/>
<p><em>StateManager</em> inicia el bucle de juego con el método <em>start</em> y se comporta como un <em>FrameListener</em>. En cada iteración se disparan los eventos <em>frameStarted</em>, <em>frameEnded</em> y <em>frameRenderingQueued</em> para actualizar lógicamente los estados activos de la pila. Así mismo recibe eventos de ventana, de teclado y de ratón que transmite a los eventos que controla.</p>
<p><strong>La idea de la pila de estados</strong> y las transiciones seguras la tomé de uno de los proyectos de mi compañero <a class="text-contentLink text-lg" href="http://josetomastocino.com/">José Tomás Tocino</a>. Lo utilizaba en un juego con <a class="text-contentLink text-lg" href="http://www.libgosu.org/">Gosu</a> mientras que yo lo he adaptado a Ogre y OIS.</p>
<h3>Conclusiones</h3>
<p>Con esto terminamos la documentación de la gestión de estados de Sion Tower. Habréis comprobado que <strong>de una forma sencilla y ordenada</strong> podemos añadir, modificar y manejar nuestros estados de juego. Sed libres (GPL 3) de reutilizar este código alojado en la <a class="text-contentLink text-lg" href="http://forja.rediris.es/scm/?group_id=820">forja de Red Iris</a>.</p>
<p><strong>¡Se aceptan sugerencias, críticas y lanzamiento de fruta podrida!</strong></p></article></main></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"metadata":{"path":"content/post/2011-04-06-gestion-de-estados-de-juego.mdx","title":"Gestión de estados de juego","date":"2011-04-06T14:10:13.000Z","categories":["Games development"],"series":null,"description":null,"slug":"gestion-de-estados-de-juego","readingTime":"5 min read","draft":false,"disableComments":false,"keywords":[],"banner":null},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    img: \"img\",\n    p: \"p\",\n    strong: \"strong\",\n    a: \"a\",\n    em: \"em\",\n    h3: \"h3\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.img, {\n      src: \"/img/wp/titulo-statemanager.webp\",\n      alt: \"titulo-statemanager.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Sion Tower cuenta con varios estados y transiciones\"\n      }), \" los cuales están especificados en el \", _jsx(_components.a, {\n        href: \"http://forja.rediris.es/frs/download.php/2019/gdd.pdf\",\n        children: \"Documento de Diseño (GDD)\"\n      }), \" que publiqué hace tiempo. Por supuesto, me refiero a estados como \", _jsx(_components.em, {\n        children: \"\\\"Juego\\\"\"\n      }), \", \", _jsx(_components.em, {\n        children: \"\\\"Menú\\\"\"\n      }), \", \", _jsx(_components.em, {\n        children: \"\\\"Selección de nivel\\\"\"\n      }), \". Me parece interesante comentar a vista de pájaro estos estados así como el sistema subyacente que los gestiona. Puede ser una buena manera para saber hasta dónde pretende llegar el juego. En este artículo hablaremos de las clases \", _jsx(_components.em, {\n        children: \"State\"\n      }), \" y \", _jsx(_components.em, {\n        children: \"StateManager\"\n      }), \" entre otras.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Diagrama de estados\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"En el siguiente diagrama se muestran los distintos estados en los que se puede encontrar Sion Tower:\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/flowchart.webp\",\n      alt: \"flowchart.png\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Menú principal\"\n        }), \": se muestra el logo del juego y la torre desde el exterior. El usuario puede elegir entre \", _jsx(_components.em, {\n          children: \"\\\"Selección de perfil\\\"\"\n        }), \", \", _jsx(_components.em, {\n          children: \"\\\"Créditos\\\"\"\n        }), \" o \", _jsx(_components.em, {\n          children: \"\\\"Salir\\\"\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Créditos\"\n        }), \": en la pantalla de créditos se sustituyen las opciones del menú principal por los nombres de los implicados en el desarrollo, como era de esperar. La única opción es volver al menú.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Selección de perfil\"\n        }), \": el usuario puede seleccionar su partida entre la lista de partidas guardadas. Así podrá recuperar los niveles desbloqueados y las habilidades adquiridas por el personaje.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Selección de nivel\"\n        }), \": se muestra una lista de los niveles disponibles según el perfil elegido. De cada nivel aparece el nombre, una descripción y un icono.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Selección de habilidades\"\n        }), \": no es posible utilizar todas las habilidades en cada nivel, el usuario debe seleccionar un número limitado de ellas.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Juego\"\n        }), \": la pantalla de juego, donde se desarrolla la acción. Si el usuario vence a los enemigos se pasa a la pantalla de victoria, en caso contrario le aparece un mensaje y se reinicia el nivel.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Fin de nivel\"\n        }), \": cuando el usuario vence se muestran los puntos obtenidos y otros logros como haber desbloqueado alguna habilidad nueva.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Para detalles adicionales podéis acudir al documento de diseño que incluye bocetos completos de cada uno de los estados.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Diagrama de clases\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"A continuación podéis ver un diagrama UML con las clases que gestionan los estados del juego. Es bastante grande así que lo mejor es hacer click sobre la imagen para ampliarla.\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/statemanager.webp\",\n      alt: \"statemanager.png\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"La clase State\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.em, {\n        children: \"State\"\n      }), \" es una clase abstracta que \", _jsx(_components.strong, {\n        children: \"modela un estado de juego genérico\"\n      }), \". Cuenta con los métodos virtuales \", _jsx(_components.em, {\n        children: \"load\"\n      }), \" y \", _jsx(_components.em, {\n        children: \"clear\"\n      }), \" para cargar y liberar los elementos que contiene sin necesidad de destruir el estado completamente. Todos los estados poseen un método \", _jsx(_components.em, {\n        children: \"update\"\n      }), \" que recibe el tiempo en ms desde el último frame (\", _jsx(_components.em, {\n        children: \"deltaT\"\n      }), \") para actualizar lógicamente los elementos de dicho estado. Los estados están preparados para recibir los eventos que captura el \", _jsx(_components.em, {\n        children: \"StateManager\"\n      }), \", por ello cuenta con los manejadores típicos de la biblioteca OIS (\", _jsx(_components.a, {\n        href: \"http://osl2.uca.es/iberogre/index.php/Manejo_b%C3%A1sico_de_OIS\",\n        children: \"más sobre OIS en IberOgre\"\n      }), \").\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Por cada estado de juego tendríamos una clase\"\n      }), \" que herede de \", _jsx(_components.em, {\n        children: \"State\"\n      }), \" como podrían ser \", _jsx(_components.em, {\n        children: \"StateGame\"\n      }), \", \", _jsx(_components.em, {\n        children: \"StateMenu\"\n      }), \" o \", _jsx(_components.em, {\n        children: \"StateCredits\"\n      }), \". Por ejemplo, el estado de juego controlaría al personaje, los enemigos y el escenario. Como podéis ver es un sistema muy genérico y extensible para otros proyectos. De hecho estoy pensando en liberarlo de forma independiente.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/menu-principal.webp\",\n      alt: \"menu-principal.png\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"La clase StateManager\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"La clase \", _jsx(_components.em, {\n        children: \"StateManager\"\n      }), \" lleva internamente una \", _jsx(_components.strong, {\n        children: \"pila de estados\"\n      }), \" lo que nos permite volver atrás por los menús del juego de forma muy sencilla. \", _jsx(_components.strong, {\n        children: \"El tope de la pila sería el estado activo\"\n      }), \" mientras que el resto pueden estar en pausa o ejecutándose en segundo plano. A través de los metodos \", _jsx(_components.em, {\n        children: \"changeState\"\n      }), \", \", _jsx(_components.em, {\n        children: \"pushState\"\n      }), \", \", _jsx(_components.em, {\n        children: \"popState\"\n      }), \" y \", _jsx(_components.em, {\n        children: \"popAllStates\"\n      }), \" se nos permite gestionar los cambios entre estados. No hay que tener cuidado con el momento en el que se hace un \", _jsx(_components.em, {\n        children: \"popState\"\n      }), \", no se destruye ningún estado en ese preciso instante. El \", _jsx(_components.em, {\n        children: \"StateManager\"\n      }), \" espera a un momento seguro para hacerlo, \", _jsx(_components.strong, {\n        children: \"no más segmentos violados\"\n      }), \" en ese aspecto.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/statestack.webp\",\n      alt: \"statestack.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.em, {\n        children: \"StateManager\"\n      }), \" inicia el bucle de juego con el método \", _jsx(_components.em, {\n        children: \"start\"\n      }), \" y se comporta como un \", _jsx(_components.em, {\n        children: \"FrameListener\"\n      }), \". En cada iteración se disparan los eventos \", _jsx(_components.em, {\n        children: \"frameStarted\"\n      }), \", \", _jsx(_components.em, {\n        children: \"frameEnded\"\n      }), \" y \", _jsx(_components.em, {\n        children: \"frameRenderingQueued\"\n      }), \" para actualizar lógicamente los estados activos de la pila. Así mismo recibe eventos de ventana, de teclado y de ratón que transmite a los eventos que controla.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"La idea de la pila de estados\"\n      }), \" y las transiciones seguras la tomé de uno de los proyectos de mi compañero \", _jsx(_components.a, {\n        href: \"http://josetomastocino.com/\",\n        children: \"José Tomás Tocino\"\n      }), \". Lo utilizaba en un juego con \", _jsx(_components.a, {\n        href: \"http://www.libgosu.org/\",\n        children: \"Gosu\"\n      }), \" mientras que yo lo he adaptado a Ogre y OIS.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Conclusiones\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Con esto terminamos la documentación de la gestión de estados de Sion Tower. Habréis comprobado que \", _jsx(_components.strong, {\n        children: \"de una forma sencilla y ordenada\"\n      }), \" podemos añadir, modificar y manejar nuestros estados de juego. Sed libres (GPL 3) de reutilizar este código alojado en la \", _jsx(_components.a, {\n        href: \"http://forja.rediris.es/scm/?group_id=820\",\n        children: \"forja de Red Iris\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"¡Se aceptan sugerencias, críticas y lanzamiento de fruta podrida!\"\n      })\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","scope":{}},"series":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"gestion-de-estados-de-juego"},"buildId":"UY4b5c_WM5CskI6M1iG7L","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>