<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/touch-icon-144-precomposed.png"/><title>Sistema de audio pseudo-3D integrado con Ogre · David Saltares</title><meta name="robots" content="index,follow"/><meta name="description" content="Engineering Leadership &amp; Software Development"/><meta property="og:title" content="Sistema de audio pseudo-3D integrado con Ogre · David Saltares"/><meta property="og:description" content="Engineering Leadership &amp; Software Development"/><meta property="og:url" content="https://saltares.com/sistema-de-audio-pseudo-3d-integrado-con-ogre"/><meta property="og:type" content="website"/><link rel="canonical" href="https://saltares.com/sistema-de-audio-pseudo-3d-integrado-con-ogre"/><meta name="keywords" content=""/><meta name="next-head-count" content="12"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/1e80e7c82199c580.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1e80e7c82199c580.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-24470d78cf61f77f.js" defer=""></script><script src="/_next/static/chunks/framework-9b5d6ec4444c80fa.js" defer=""></script><script src="/_next/static/chunks/main-e42aac98337d61c6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-89283805d41ea493.js" defer=""></script><script src="/_next/static/chunks/c16184b3-9b756f0214555638.js" defer=""></script><script src="/_next/static/chunks/2cca2479-c0f2c9f2f2dc1702.js" defer=""></script><script src="/_next/static/chunks/252-64d0c1a5eecbfabd.js" defer=""></script><script src="/_next/static/chunks/167-7d296999b3b0013a.js" defer=""></script><script src="/_next/static/chunks/962-68c39fb6207889be.js" defer=""></script><script src="/_next/static/chunks/673-8982310ab2fdaad5.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-d0bad99a4f6f3b56.js" defer=""></script><script src="/_next/static/fhvwWNgMks5y-M1ZhV0Rq/_buildManifest.js" defer=""></script><script src="/_next/static/fhvwWNgMks5y-M1ZhV0Rq/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap">@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col md:flex-row font-sans text-xl w-full"><aside class="md:max-w-[360px] bg-primary px-10 py-10 text-white text-xl md:fixed md:top-0 md:left-0 md:h-full flex flex-col justify-end items-center md:items-start"><div><a href="/"><div class="mb-5"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27200%27%20height=%27200%27/%3e"/></span><img alt="profile picture" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="profile picture" src="/img/profile.webp" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span></div><h1 class="text-white font-bold text-4xl leading-10">David Saltares</h1></a></div><p class="text-contentLight text-2xl mb-5 leading-9 text-center md:text-left">Engineering Leadership &amp; Software Development</p><a href="https://tinyletter.com/dsaltares/"><p class="mb-5">✉️ Subscribe</p></a><nav><ul class="mb-5 flex flex-col items-center md:items-start list-none pl-0"><li class="leading-7"><a href="/">Blog</a></li><li class="leading-7"><a href="/about-me/">About</a></li><li class="leading-7"><a href="/apps-tools/">Apps &amp; Tools</a></li><li class="leading-7"><a href="/game-jams/">Game Jams</a></li><li class="leading-7"><a href="/games/">Games</a></li><li class="leading-7"><a href="/libgdx-cross-platform-game-development-cookbook/">Libgdx Cookbook</a></li></ul></nav><ul class="mb-5 list-none pl-0"><li class="inline"><a aria-label="Github profile" href="https://github.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-github" class="svg-inline--fa fa-square-github text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></li><li class="inline"><a aria-label="Linkedin profile" href="https://www.linkedin.com/in/davidsaltares/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="inline"><a aria-label="Twitter profile" href="https://twitter.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-twitter" class="svg-inline--fa fa-square-twitter text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg></a></li><li class="inline"><a aria-label="RSS feed" href="https://saltares.com/index.xml"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path></svg></a></li><li class="inline"><a rel="me" href="https://fosstodon.org/@dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a></li></ul><p class="text-contentLight text-lg">© 2023 David Saltares.</p></aside><div class="md:max-w-[360px] w-full hidden md:block flex-grow-0 flex-shrink-0"></div><div class="flex flex-col main-content"><main class="w-full max-w-[720px] pr-4 py-10 pl-5 md:py-20 md:pl-20"><article class="text-content mb-10"><div><a href="/sistema-de-audio-pseudo-3d-integrado-con-ogre/"><h1 class="font-bold text-4xl mb-2 text-primary">Sistema de audio pseudo-3D integrado con Ogre</h1></a><p class="flex text-contentLight mb-1">Dec 30 2010 · 5 min read<span> · </span><a class="text-contentLink" href="/sistema-de-audio-pseudo-3d-integrado-con-ogre/#disqus_thread">Comments</a></p><div class="mb-3"><div class="flex flex-row gap-1"><a class="px-2 py-1 bg-slate-900 text-white rounded font-bold text-sm" href="/categories/games-development/">Games development</a></div></div></div><img class="mb-1" src="/img/wp/audio3d-ogre1.webp" alt="audio3d-ogre1.png"/>
<p>Como todo buen hijo de vecino, <strong><a class="text-contentLink text-lg" href="/category/proyectos/pfc/sion-tower/">Sion Tower</a> necesitará reproducir efectos de sonido y música</strong> de fondo, de otro modo al jugador se le caerían dos lagrimones y lo cerraría para siempre. Ogre es un motor de renderizado y no incorpora elementos como un subsistema de audio, por tanto, debía buscarlo en otro lugar. Como he comentado anteriormente, Ogre cuenta con un sistema de gestión de recursos muy potente y ampliable. Sobra decir que mi audio debería <strong>integrarse completamente</strong> con dicho sistema. A continuación, relato mi pequeña odisea para conseguir lo deseado.</p>
<h3>Elegir una biblioteca de audio</h3>
<p>Debía elegir una biblioteca para gestionar el audio, al menos a bajo nivel. <strong>Las opciones más evidentes eran <a class="text-contentLink text-lg" href="http://es.wikipedia.org/wiki/Simple_DirectMedia_Layer#Componentes_adicionales">SDL Mixer</a> y <a class="text-contentLink text-lg" href="http://es.wikipedia.org/wiki/OpenAL">OpenAL</a></strong>. Indagando un poco, encontré una biblioteca auxiliar llamada <strong><a class="text-contentLink text-lg" href="http://www.ogre3d.org/tikiwiki/OgreOggSound&amp;structure=Libraries">OgreOggSound</a></strong> que integraba OpenAL con Ogre incorporando audio 3D. Los ojos se me abrieron como platos pero me llevé una decepción cuando vi que la documentación brillaba por su ausencia. Además, <strong>prefería aprender</strong> la forma de extender la gestión de recursos de Ogre y cacharrear un poco con el audio.</p>
<p><strong>OpenAL</strong> es al sonido lo que OpenGL al 3D en el ámbito open source. Es compatible con decenas de plataformas y está enfocada al desarrollo de videojuegos en 3D. Títulos triple A como Doom 3, Battlefield 2 o Jedi Knight lo han utilizado. Como era de esperar, es un <strong>sistema muy grande y complejo</strong>.</p>
<p><strong>SDL Mixer</strong> es una biblioteca <strong>pequeña y sencilla</strong> que me permite regular aspectos como volumen y ángulo para provocar un efecto pseudo 3D. Ya había trabajado con ella en <a class="text-contentLink text-lg" href="/proyectos/air-force-pilot/">Air Force Pilot</a> y en <a class="text-contentLink text-lg" href="/proyectos/grannys-bloodbath/">Granny&#x27;s Bloodbath</a> de forma satisfactoria. Además, es compatible con las plataformas que necesito. En fin, es más limitada pero me basta para mis necesidades.</p>
<h3>Integración con la gestión de recursos de Ogre</h3>
<p>Los recursos que queramos <strong>integrar con Ogre</strong> deben implementar la interfaz <a class="text-contentLink text-lg" href="http://www.ogre3d.org/docs/api/html/classOgre_1_1Resource.html">Resource</a>. Ogre utiliza el <a class="text-contentLink text-lg" href="http://www.ogre3d.org/docs/api/html/classOgre_1_1ResourceGroupManager.html">ResourceGroupManager</a> para gestionar los recursos a nivel global pero tiene un <a class="text-contentLink text-lg" href="http://www.ogre3d.org/docs/api/html/classOgre_1_1ResourceManager.html">ResourceManager</a> para cada tipo de recurso. Esto quiere decir que tenemos que implementar clases que hereden de ResourceManager. Los gestores de recursos no manejan objetos Resource directamente, sino que utilizan punteros inteligentes, <a class="text-contentLink text-lg" href="http://www.ogre3d.org/docs/api/html/classOgre_1_1SharedPtr.html">SharedPtr</a> muy similares a los <a class="text-contentLink text-lg" href="http://www.boost.org/doc/libs/1_45_0/libs/smart_ptr/shared_ptr.htm">shared_ptr</a> de Boost. Esto les permite mantener una sola instancia de cada recurso compartida por varias entidades.</p>
<p>SDL Mixer trata de forma distinta la música y los efectos de sonido por lo que planteé <strong>dos nuevos recursos: Musica y Sonido</strong>. A continuación tenéis la lista de clases resultante aunque al final de este artículo se expone un diagrama UML completo.</p>
<ul>
<li>SoundFX y SoundFXPtr</li>
<li>Song y SongPtr</li>
<li>SoundFXManager</li>
<li>SongManager</li>
</ul>
<p>La forma de trabajar con los nuevos recursos es semejante al estilo de Ogre. Queda completamente integrado:</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">// Al arrancar la aplicación
SoundFXManager* soundFXManager = new SoundFXManager();

// Durante la carga de algún estado
// Se le indica el nombre del recurso, ResourceGroupManager
// te proporciona la ruta completa.
SoundFXPtr sound = SoundFXManager::getSingleton().load(&amp;quot;disparo.wav&amp;quot;);

// Durante el game loop
sound-&amp;gt;play();

// Al cerrar la aplicación
delete soundFXManager;</code></pre></div>
<h3>Sencillo pero resultón sonido 3D</h3>
<p>No todos los sonidos tienen porqué reproducirse con efecto 3D por lo que he modelado este pequeño sistema de forma independiente. <strong>La clase Sound3D</strong> tiene un SoundFXPtr y dos punteros a SceneNode. Uno de los nodos es el emisor y el otro el que escucha. El volumen varía en función de la distancia entre ambos nodos mientras que el ángulo entre ambos elementos produce un efecto estéreo. El siguiente diagrama lo ilustra:</p>
<img class="mb-1" src="/img/wp/audio3d-esquema.webp" alt="audio3d-esquema.png"/>
<p>SDL Mixer distribuye los efectos de sonido en los canales que se hayan reservado a tal efecto. Un mismo Sound3D puede estar reproduciéndose en canales distintos al mismo tiempo. La clase Sound3D controla internamente qué sonido tiene asociado cada canal. Se pone a disposición del desarrollador un <strong>método estático para actualizar todos los sonidos 3D</strong> en reproducción. Preferiblemente una vez por cada iteración del game loop deberíamos hacer:</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">// Actualizar todos los sonidos 3D en reproducción
Sound3D::update3DSound();</code></pre></div>
<h3>A vista de pájaro</h3>
<p>El siguiente <strong>diagrama de clases</strong> simplificado ilustra a grandes rasgos los elementos de este sistema de audio y sus relaciones.</p>
<img class="mb-1" src="/img/wp/audio3d-clases1.webp" alt="audio3d-clases1.png"/>
<h3>Para terminar</h3>
<p>¡Vaya, me he extendido más de la cuenta! Han sido dos días intensos de trabajo entre aprender a extender la gestión de recursos de Ogre e implementación. En principio he desarrollado este sistema de sonido para Sion Tower pero en realidad <strong>es completamente independiente</strong>. Si estás desarrollando un juego y te interesa, acude a la <a class="text-contentLink text-lg" href="https://forja.rediris.es/projects/cusl5-iberogre/">forja</a> y utiliza lo que desees (es GPL).</p>
<p>Seguiré informando de mis avances, muchas gracias por leer.</p></article></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"path":"content/post/2010-12-30-sistema-de-audio-pseudo-3d-integrado-con-ogre.mdx","title":"Sistema de audio pseudo-3D integrado con Ogre","date":"2010-12-30T17:05:00.000Z","categories":["Games development"],"series":null,"description":null,"slug":"sistema-de-audio-pseudo-3d-integrado-con-ogre","readingTime":"5 min read","draft":false,"disableComments":false,"keywords":[],"banner":null},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    img: \"img\",\n    p: \"p\",\n    strong: \"strong\",\n    a: \"a\",\n    h3: \"h3\",\n    ul: \"ul\",\n    li: \"li\",\n    div: \"div\",\n    pre: \"pre\",\n    code: \"code\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.img, {\n      src: \"/img/wp/audio3d-ogre1.webp\",\n      alt: \"audio3d-ogre1.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Como todo buen hijo de vecino, \", _jsxs(_components.strong, {\n        children: [_jsx(_components.a, {\n          href: \"/category/proyectos/pfc/sion-tower/\",\n          children: \"Sion Tower\"\n        }), \" necesitará reproducir efectos de sonido y música\"]\n      }), \" de fondo, de otro modo al jugador se le caerían dos lagrimones y lo cerraría para siempre. Ogre es un motor de renderizado y no incorpora elementos como un subsistema de audio, por tanto, debía buscarlo en otro lugar. Como he comentado anteriormente, Ogre cuenta con un sistema de gestión de recursos muy potente y ampliable. Sobra decir que mi audio debería \", _jsx(_components.strong, {\n        children: \"integrarse completamente\"\n      }), \" con dicho sistema. A continuación, relato mi pequeña odisea para conseguir lo deseado.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Elegir una biblioteca de audio\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Debía elegir una biblioteca para gestionar el audio, al menos a bajo nivel. \", _jsxs(_components.strong, {\n        children: [\"Las opciones más evidentes eran \", _jsx(_components.a, {\n          href: \"http://es.wikipedia.org/wiki/Simple_DirectMedia_Layer#Componentes_adicionales\",\n          children: \"SDL Mixer\"\n        }), \" y \", _jsx(_components.a, {\n          href: \"http://es.wikipedia.org/wiki/OpenAL\",\n          children: \"OpenAL\"\n        })]\n      }), \". Indagando un poco, encontré una biblioteca auxiliar llamada \", _jsx(_components.strong, {\n        children: _jsx(_components.a, {\n          href: \"http://www.ogre3d.org/tikiwiki/OgreOggSound\u0026structure=Libraries\",\n          children: \"OgreOggSound\"\n        })\n      }), \" que integraba OpenAL con Ogre incorporando audio 3D. Los ojos se me abrieron como platos pero me llevé una decepción cuando vi que la documentación brillaba por su ausencia. Además, \", _jsx(_components.strong, {\n        children: \"prefería aprender\"\n      }), \" la forma de extender la gestión de recursos de Ogre y cacharrear un poco con el audio.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"OpenAL\"\n      }), \" es al sonido lo que OpenGL al 3D en el ámbito open source. Es compatible con decenas de plataformas y está enfocada al desarrollo de videojuegos en 3D. Títulos triple A como Doom 3, Battlefield 2 o Jedi Knight lo han utilizado. Como era de esperar, es un \", _jsx(_components.strong, {\n        children: \"sistema muy grande y complejo\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"SDL Mixer\"\n      }), \" es una biblioteca \", _jsx(_components.strong, {\n        children: \"pequeña y sencilla\"\n      }), \" que me permite regular aspectos como volumen y ángulo para provocar un efecto pseudo 3D. Ya había trabajado con ella en \", _jsx(_components.a, {\n        href: \"/proyectos/air-force-pilot/\",\n        children: \"Air Force Pilot\"\n      }), \" y en \", _jsx(_components.a, {\n        href: \"/proyectos/grannys-bloodbath/\",\n        children: \"Granny's Bloodbath\"\n      }), \" de forma satisfactoria. Además, es compatible con las plataformas que necesito. En fin, es más limitada pero me basta para mis necesidades.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Integración con la gestión de recursos de Ogre\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Los recursos que queramos \", _jsx(_components.strong, {\n        children: \"integrar con Ogre\"\n      }), \" deben implementar la interfaz \", _jsx(_components.a, {\n        href: \"http://www.ogre3d.org/docs/api/html/classOgre_1_1Resource.html\",\n        children: \"Resource\"\n      }), \". Ogre utiliza el \", _jsx(_components.a, {\n        href: \"http://www.ogre3d.org/docs/api/html/classOgre_1_1ResourceGroupManager.html\",\n        children: \"ResourceGroupManager\"\n      }), \" para gestionar los recursos a nivel global pero tiene un \", _jsx(_components.a, {\n        href: \"http://www.ogre3d.org/docs/api/html/classOgre_1_1ResourceManager.html\",\n        children: \"ResourceManager\"\n      }), \" para cada tipo de recurso. Esto quiere decir que tenemos que implementar clases que hereden de ResourceManager. Los gestores de recursos no manejan objetos Resource directamente, sino que utilizan punteros inteligentes, \", _jsx(_components.a, {\n        href: \"http://www.ogre3d.org/docs/api/html/classOgre_1_1SharedPtr.html\",\n        children: \"SharedPtr\"\n      }), \" muy similares a los \", _jsx(_components.a, {\n        href: \"http://www.boost.org/doc/libs/1_45_0/libs/smart_ptr/shared_ptr.htm\",\n        children: \"shared_ptr\"\n      }), \" de Boost. Esto les permite mantener una sola instancia de cada recurso compartida por varias entidades.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"SDL Mixer trata de forma distinta la música y los efectos de sonido por lo que planteé \", _jsx(_components.strong, {\n        children: \"dos nuevos recursos: Musica y Sonido\"\n      }), \". A continuación tenéis la lista de clases resultante aunque al final de este artículo se expone un diagrama UML completo.\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"SoundFX y SoundFXPtr\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Song y SongPtr\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"SoundFXManager\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"SongManager\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"La forma de trabajar con los nuevos recursos es semejante al estilo de Ogre. Queda completamente integrado:\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"// Al arrancar la aplicación\\nSoundFXManager* soundFXManager = new SoundFXManager();\\n\\n// Durante la carga de algún estado\\n// Se le indica el nombre del recurso, ResourceGroupManager\\n// te proporciona la ruta completa.\\nSoundFXPtr sound = SoundFXManager::getSingleton().load(\u0026quot;disparo.wav\u0026quot;);\\n\\n// Durante el game loop\\nsound-\u0026gt;play();\\n\\n// Al cerrar la aplicación\\ndelete soundFXManager;\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Sencillo pero resultón sonido 3D\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"No todos los sonidos tienen porqué reproducirse con efecto 3D por lo que he modelado este pequeño sistema de forma independiente. \", _jsx(_components.strong, {\n        children: \"La clase Sound3D\"\n      }), \" tiene un SoundFXPtr y dos punteros a SceneNode. Uno de los nodos es el emisor y el otro el que escucha. El volumen varía en función de la distancia entre ambos nodos mientras que el ángulo entre ambos elementos produce un efecto estéreo. El siguiente diagrama lo ilustra:\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/audio3d-esquema.webp\",\n      alt: \"audio3d-esquema.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"SDL Mixer distribuye los efectos de sonido en los canales que se hayan reservado a tal efecto. Un mismo Sound3D puede estar reproduciéndose en canales distintos al mismo tiempo. La clase Sound3D controla internamente qué sonido tiene asociado cada canal. Se pone a disposición del desarrollador un \", _jsx(_components.strong, {\n        children: \"método estático para actualizar todos los sonidos 3D\"\n      }), \" en reproducción. Preferiblemente una vez por cada iteración del game loop deberíamos hacer:\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"// Actualizar todos los sonidos 3D en reproducción\\nSound3D::update3DSound();\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"A vista de pájaro\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"El siguiente \", _jsx(_components.strong, {\n        children: \"diagrama de clases\"\n      }), \" simplificado ilustra a grandes rasgos los elementos de este sistema de audio y sus relaciones.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/audio3d-clases1.webp\",\n      alt: \"audio3d-clases1.png\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Para terminar\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"¡Vaya, me he extendido más de la cuenta! Han sido dos días intensos de trabajo entre aprender a extender la gestión de recursos de Ogre e implementación. En principio he desarrollado este sistema de sonido para Sion Tower pero en realidad \", _jsx(_components.strong, {\n        children: \"es completamente independiente\"\n      }), \". Si estás desarrollando un juego y te interesa, acude a la \", _jsx(_components.a, {\n        href: \"https://forja.rediris.es/projects/cusl5-iberogre/\",\n        children: \"forja\"\n      }), \" y utiliza lo que desees (es GPL).\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Seguiré informando de mis avances, muchas gracias por leer.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","scope":{}},"series":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"sistema-de-audio-pseudo-3d-integrado-con-ogre"},"buildId":"fhvwWNgMks5y-M1ZhV0Rq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>