<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/touch-icon-144-precomposed.png"/><title>Thoughts on unit testing for Ashley and games in general · David Saltares</title><meta name="robots" content="index,follow"/><meta name="description" content="Engineering Leadership &amp; Software Development"/><meta property="og:title" content="Thoughts on unit testing for Ashley and games in general · David Saltares"/><meta property="og:description" content="Engineering Leadership &amp; Software Development"/><meta property="og:url" content="https://saltares.com/thoughts-on-unit-testing-for-ashley-and-games-in-general"/><meta property="og:type" content="website"/><link rel="canonical" href="https://saltares.com/thoughts-on-unit-testing-for-ashley-and-games-in-general"/><meta name="keywords" content=""/><meta name="next-head-count" content="12"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/d3d4cc303d9c1080.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/d3d4cc303d9c1080.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7671224c423a1e1f.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-66d32731bdd20e83.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-41a9ee3ebe735abe.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-75760b031d352622.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/c16184b3-5eed107b4bbcea31.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/2cca2479-0d4bcd71a6a0316a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/252-2454d8293e83336b.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/167-6fe50976be6d0e53.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/962-ea29c7731d832d32.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/373-f5166c707bca4ed3.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-81b48131ea6e98cc.js" defer="" crossorigin=""></script><script src="/_next/static/UY4b5c_WM5CskI6M1iG7L/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/UY4b5c_WM5CskI6M1iG7L/_ssgManifest.js" defer="" crossorigin=""></script><style data-href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap">@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col md:flex-row font-sans text-xl w-full"><aside class="md:max-w-[360px] bg-primary px-10 py-10 text-white text-xl md:fixed md:top-0 md:left-0 md:h-full flex flex-col justify-end items-center md:items-start"><div><a href="/"><div class="mb-5"><img alt="profile picture" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="rounded-full" style="color:transparent" src="/img/profile.webp"/></div><h1 class="text-white font-bold text-4xl leading-10">David Saltares</h1></a></div><p class="text-contentLight text-2xl mb-5 leading-9 text-center md:text-left">Engineering Leadership &amp; Software Development</p><div class="mb-5 font-base"><button class="ml-onclick-form" onclick="ml('show', '646AL4', true)">✉️ Subscribe</button></div><nav><ul class="mb-5 flex flex-col items-center md:items-start list-none pl-0"><li class="leading-7"><a href="/">Blog</a></li><li class="leading-7"><a href="/about-me/">About</a></li><li class="leading-7"><a href="/apps-tools/">Apps &amp; Tools</a></li><li class="leading-7"><a href="/game-jams/">Game Jams</a></li><li class="leading-7"><a href="/games/">Games</a></li><li class="leading-7"><a href="/libgdx-cross-platform-game-development-cookbook/">Libgdx Cookbook</a></li></ul></nav><ul class="mb-5 list-none pl-0"><li class="inline"><a aria-label="Github profile" href="https://github.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-github" class="svg-inline--fa fa-square-github text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></li><li class="inline"><a aria-label="Linkedin profile" href="https://www.linkedin.com/in/davidsaltares/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="inline"><a aria-label="Twitter profile" href="https://twitter.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-twitter" class="svg-inline--fa fa-square-twitter text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg></a></li><li class="inline"><a aria-label="RSS feed" href="https://saltares.com/index.xml"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path></svg></a></li><li class="inline"><a rel="me" href="https://fosstodon.org/@dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a></li></ul><p class="text-contentLight text-lg">© 2024 David Saltares.</p></aside><div class="md:max-w-[360px] w-full hidden md:block flex-grow-0 flex-shrink-0"></div><div class="flex flex-col main-content"><main class="w-full max-w-[720px] pr-4 py-10 pl-5 md:py-20 md:pl-20"><article class="text-content mb-10"><div><a href="/thoughts-on-unit-testing-for-ashley-and-games-in-general/"><h1 class="font-bold text-4xl mb-2 text-primary">Thoughts on unit testing for Ashley and games in general</h1></a><p class="flex text-contentLight mb-1">Dec 13 2015 · 5 min read<span> · </span><a class="text-contentLink" href="/thoughts-on-unit-testing-for-ashley-and-games-in-general/#disqus_thread">Comments</a></p><div class="mb-3"><div class="flex flex-row gap-1"><a class="px-2 py-1 bg-slate-900 text-white rounded font-bold text-sm" href="/categories/games-development/">Games development</a></div></div></div><p>Shortly after we moved <a class="text-contentLink text-lg" href="https://github.com/libgdx/ashley">Ashley</a> into the <a class="text-contentLink text-lg" href="https://github.com/libgdx">Libgdx</a> family, we started writing <a class="text-contentLink text-lg" href="https://github.com/libgdx/ashley/tree/master/ashley/tests/com/badlogic/ashley">unit tests</a> for every single component in the framework using <a class="text-contentLink text-lg" href="http://junit.org/">jUnit</a>.</p>
<h3>Unit testing goodness</h3>
<p>That was over a year and a half ago and it has proven to be a huge win for many reasons.</p>
<ul>
<li>Issue reporters can (and should) include a <a class="text-contentLink text-lg" href="https://github.com/libgdx/ashley/issues/173">test that breaks</a> as a way of explaining the problem. We can then easily include it into the suite, fix it and prevent future regressions.</li>
<li>Pull requests <a class="text-contentLink text-lg" href="https://github.com/libgdx/ashley/pull/187">trigger a build</a> in Jenkins that compiles the code and runs all the unit tests. Code reviews should check for design, good practices as well as correctness. However, as long as the tests have good coverage, we can be pretty sure the change won&#x27;t break existing code.</li>
<li>Since, it is mandatory to include extensive unit tests with each new feature, we can increase quality from the get go.</li>
<li>Refactoring becomes a lot easier. We lose fear of cleaning up ugly parts of the codebase because we have unit tests to make sure the behaviour remains the same. This became evident with the recent <a class="text-contentLink text-lg" href="https://github.com/libgdx/ashley/commit/261342f74dc7c1b955e7605aadeb9bfcbc112128">Engine internal refactor</a>.</li>
</ul>
<p>The morale is basically as follows.</p>
<img class="mb-1" src="/img/wp/unit-test-all-the-things.webp" alt="unit-test-all-the-things.png"/>
<p>Our <a class="text-contentLink text-lg" href="https://github.com/libgdx/ashley/issues?q=is%3Aissue+is%3Aclosed">issue tracker</a> proves that we&#x27;re far from perfect, which makes me thing about where we&#x27;d be if it weren&#x27;t for unit tests. Ashley inherently has lots of tricky bits of logic and potential edge cases. Making sure we don&#x27;t break anything without automated tests would almost impossible.</p>
<p>That is why, every time we break something, we add a unit test with the fix and make sure it never ever happens again.</p>
<h3>Lack of unit testing in the games industry</h3>
<p>When I left the games industry as a full time occupation something struck me. There&#x27;s an incredibly poor unit testing culture in games compared to other industries. Sure, other industries are also affected by this disease but I&#x27;ve felt a lack of attitude in the games world to change the situation.</p>
<p>This is really, really bad.</p>
<p>As you surely know, games are complex pieces of code. Many systems with non-trivial logic interact in a real-time simulation all at once. Games development is hard! Actually, it&#x27;s more than that! It&#x27;s brain melting!</p>
<p>When a deadline approaches and the bug count shoots over the roof, we put in hacky fixes and hope for the best. Then our WTFs per line increase and no one ever dares to fix it because they&#x27;re scared of breaking everything. So we keep pushing forward until the game&#x27;s unavoidably collapses on us.</p>
<img class="mb-1" src="/img/wp/wtf.webp" alt="wtf.png"/>
<p>Some people may say that decoupling and correctly abstracting code for it to be more easily testable may add an overhead games cannot afford. I would tell them that&#x27;s a huge empty fallacy until proven otherwise and quite possibly fall within <a class="text-contentLink text-lg" href="http://c2.com/cgi/wiki?PrematureOptimization">premature optimisation</a>. These claims need to be backed by profiling data and I seriously doubt these practices will become someone&#x27;s main bottleneck.</p>
<p>Clean and performant code is possible.</p>
<h3>We can do better than this</h3>
<p>Admittedly, games are very hard to test. How can you unit test a shader or a behaviour script? Many things depend on graphics or user input and we cannot automate them!</p>
<p>Here is a few things you can do.</p>
<ul>
<li>Unit test foundational classes like <a class="text-contentLink text-lg" href="https://github.com/libgdx/libgdx/blob/master/gdx/test/com/badlogic/gdx/math/IntersectorTest.java">geometry intersectors</a> or <a class="text-contentLink text-lg" href="https://github.com/libgdx/libgdx/blob/master/gdx/test/com/badlogic/gdx/utils/PooledLinkedListTest.java">containers</a>.</li>
<li>Write tests for game specific logic that does not depend on graphics nor user input.</li>
<li>Make sure you have a <a class="text-contentLink text-lg" href="https://github.com/libgdx/libgdx/tree/master/backends/gdx-backend-headless">headless backend</a> for your engine, that way you can run it without requiring a graphic environment.</li>
<li>Use <a class="text-contentLink text-lg" href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a>, so you can mock those dependencies in a unit test. Don&#x27;t have your <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">Player</code> internally use a <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">PlayerController</code>, give it a reference to <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">ControllerInterface</code> in the constructor. This way you can test Player behaves well without relying on an actual keyboard.</li>
</ul>
<p>Higher level systems can be really tricky to test, especially if they&#x27;re strongly tied to user input. In those situations, you can write an <a class="text-contentLink text-lg" href="https://en.wikipedia.org/wiki/Integration_testing">integration test</a> that fakes user input and validate the output.</p>
<p>Designing your game to be unit testable is hard and may take longer but think about it as an investment. In the long run, you will face less roadblocks and will be able to iterate faster. No need to do this for a game jam prototype although I would certainly recommend it for a more serious project.</p>
<p>It&#x27;s undeniable that writing unit tests is time consuming but I strongly believe the games industry completely underestimate their usefulness.</p>
<p>Finally, let me recommend <a class="text-contentLink text-lg" href="/computing/book-review-clean-code/">Clean Code</a> again.</p></article></main></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"metadata":{"path":"content/post/2015-12-13-thoughts-on-unit-testing-for-ashley-and-games-in-general.mdx","title":"Thoughts on unit testing for Ashley and games in general","date":"2015-12-13T15:21:50.000Z","categories":["Games development"],"series":null,"description":null,"slug":"thoughts-on-unit-testing-for-ashley-and-games-in-general","readingTime":"5 min read","draft":false,"disableComments":false,"keywords":[],"banner":null},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    h3: \"h3\",\n    ul: \"ul\",\n    li: \"li\",\n    img: \"img\",\n    code: \"code\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Shortly after we moved \", _jsx(_components.a, {\n        href: \"https://github.com/libgdx/ashley\",\n        children: \"Ashley\"\n      }), \" into the \", _jsx(_components.a, {\n        href: \"https://github.com/libgdx\",\n        children: \"Libgdx\"\n      }), \" family, we started writing \", _jsx(_components.a, {\n        href: \"https://github.com/libgdx/ashley/tree/master/ashley/tests/com/badlogic/ashley\",\n        children: \"unit tests\"\n      }), \" for every single component in the framework using \", _jsx(_components.a, {\n        href: \"http://junit.org/\",\n        children: \"jUnit\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Unit testing goodness\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"That was over a year and a half ago and it has proven to be a huge win for many reasons.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Issue reporters can (and should) include a \", _jsx(_components.a, {\n          href: \"https://github.com/libgdx/ashley/issues/173\",\n          children: \"test that breaks\"\n        }), \" as a way of explaining the problem. We can then easily include it into the suite, fix it and prevent future regressions.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Pull requests \", _jsx(_components.a, {\n          href: \"https://github.com/libgdx/ashley/pull/187\",\n          children: \"trigger a build\"\n        }), \" in Jenkins that compiles the code and runs all the unit tests. Code reviews should check for design, good practices as well as correctness. However, as long as the tests have good coverage, we can be pretty sure the change won't break existing code.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Since, it is mandatory to include extensive unit tests with each new feature, we can increase quality from the get go.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Refactoring becomes a lot easier. We lose fear of cleaning up ugly parts of the codebase because we have unit tests to make sure the behaviour remains the same. This became evident with the recent \", _jsx(_components.a, {\n          href: \"https://github.com/libgdx/ashley/commit/261342f74dc7c1b955e7605aadeb9bfcbc112128\",\n          children: \"Engine internal refactor\"\n        }), \".\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The morale is basically as follows.\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/unit-test-all-the-things.webp\",\n      alt: \"unit-test-all-the-things.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Our \", _jsx(_components.a, {\n        href: \"https://github.com/libgdx/ashley/issues?q=is%3Aissue+is%3Aclosed\",\n        children: \"issue tracker\"\n      }), \" proves that we're far from perfect, which makes me thing about where we'd be if it weren't for unit tests. Ashley inherently has lots of tricky bits of logic and potential edge cases. Making sure we don't break anything without automated tests would almost impossible.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"That is why, every time we break something, we add a unit test with the fix and make sure it never ever happens again.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Lack of unit testing in the games industry\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When I left the games industry as a full time occupation something struck me. There's an incredibly poor unit testing culture in games compared to other industries. Sure, other industries are also affected by this disease but I've felt a lack of attitude in the games world to change the situation.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is really, really bad.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"As you surely know, games are complex pieces of code. Many systems with non-trivial logic interact in a real-time simulation all at once. Games development is hard! Actually, it's more than that! It's brain melting!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When a deadline approaches and the bug count shoots over the roof, we put in hacky fixes and hope for the best. Then our WTFs per line increase and no one ever dares to fix it because they're scared of breaking everything. So we keep pushing forward until the game's unavoidably collapses on us.\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/wtf.webp\",\n      alt: \"wtf.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Some people may say that decoupling and correctly abstracting code for it to be more easily testable may add an overhead games cannot afford. I would tell them that's a huge empty fallacy until proven otherwise and quite possibly fall within \", _jsx(_components.a, {\n        href: \"http://c2.com/cgi/wiki?PrematureOptimization\",\n        children: \"premature optimisation\"\n      }), \". These claims need to be backed by profiling data and I seriously doubt these practices will become someone's main bottleneck.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Clean and performant code is possible.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"We can do better than this\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Admittedly, games are very hard to test. How can you unit test a shader or a behaviour script? Many things depend on graphics or user input and we cannot automate them!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here is a few things you can do.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Unit test foundational classes like \", _jsx(_components.a, {\n          href: \"https://github.com/libgdx/libgdx/blob/master/gdx/test/com/badlogic/gdx/math/IntersectorTest.java\",\n          children: \"geometry intersectors\"\n        }), \" or \", _jsx(_components.a, {\n          href: \"https://github.com/libgdx/libgdx/blob/master/gdx/test/com/badlogic/gdx/utils/PooledLinkedListTest.java\",\n          children: \"containers\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Write tests for game specific logic that does not depend on graphics nor user input.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Make sure you have a \", _jsx(_components.a, {\n          href: \"https://github.com/libgdx/libgdx/tree/master/backends/gdx-backend-headless\",\n          children: \"headless backend\"\n        }), \" for your engine, that way you can run it without requiring a graphic environment.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Use \", _jsx(_components.a, {\n          href: \"https://en.wikipedia.org/wiki/Dependency_injection\",\n          children: \"dependency injection\"\n        }), \", so you can mock those dependencies in a unit test. Don't have your \", _jsx(_components.code, {\n          children: \"Player\"\n        }), \" internally use a \", _jsx(_components.code, {\n          children: \"PlayerController\"\n        }), \", give it a reference to \", _jsx(_components.code, {\n          children: \"ControllerInterface\"\n        }), \" in the constructor. This way you can test Player behaves well without relying on an actual keyboard.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Higher level systems can be really tricky to test, especially if they're strongly tied to user input. In those situations, you can write an \", _jsx(_components.a, {\n        href: \"https://en.wikipedia.org/wiki/Integration_testing\",\n        children: \"integration test\"\n      }), \" that fakes user input and validate the output.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Designing your game to be unit testable is hard and may take longer but think about it as an investment. In the long run, you will face less roadblocks and will be able to iterate faster. No need to do this for a game jam prototype although I would certainly recommend it for a more serious project.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"It's undeniable that writing unit tests is time consuming but I strongly believe the games industry completely underestimate their usefulness.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Finally, let me recommend \", _jsx(_components.a, {\n        href: \"/computing/book-review-clean-code/\",\n        children: \"Clean Code\"\n      }), \" again.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","scope":{}},"series":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"thoughts-on-unit-testing-for-ashley-and-games-in-general"},"buildId":"UY4b5c_WM5CskI6M1iG7L","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>