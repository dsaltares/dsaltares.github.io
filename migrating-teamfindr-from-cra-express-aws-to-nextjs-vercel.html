<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/touch-icon-144-precomposed.png"/><title>Migrating Teamfindr from CRA+Express+AWS to Next.js+Vercel · David Saltares</title><meta name="robots" content="index,follow"/><meta name="description" content="TeamFindr is an app to organise games with friends. I migrated it from a CRA to a Next.js app. In this post, I cover why, the process and some resulting metrics."/><meta property="og:title" content="Migrating Teamfindr from CRA+Express+AWS to Next.js+Vercel · David Saltares"/><meta property="og:description" content="TeamFindr is an app to organise games with friends. I migrated it from a CRA to a Next.js app. In this post, I cover why, the process and some resulting metrics."/><meta property="og:url" content="https://saltares.com/migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel"/><meta property="og:type" content="website"/><meta property="og:image" content="https://saltares.com/img/teamfindr/teamfindr_00001.webp"/><link rel="canonical" href="https://saltares.com/migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel"/><meta name="keywords" content="TeamFindr,side project,CRA,create React app,Next.js,AWS,Vercel,React,EC2,Docker,software migration,performance,REST API"/><meta name="next-head-count" content="13"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/4b71451bcce7901f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4b71451bcce7901f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-c42a0f6119b4ccf9.js" defer=""></script><script src="/_next/static/chunks/framework-9b5d6ec4444c80fa.js" defer=""></script><script src="/_next/static/chunks/main-4203e90d77ee7e35.js" defer=""></script><script src="/_next/static/chunks/pages/_app-89283805d41ea493.js" defer=""></script><script src="/_next/static/chunks/c16184b3-9b756f0214555638.js" defer=""></script><script src="/_next/static/chunks/2cca2479-694527f642f40fc9.js" defer=""></script><script src="/_next/static/chunks/252-942ffe812f0b5120.js" defer=""></script><script src="/_next/static/chunks/167-7d296999b3b0013a.js" defer=""></script><script src="/_next/static/chunks/962-68c39fb6207889be.js" defer=""></script><script src="/_next/static/chunks/673-8982310ab2fdaad5.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-4cf92061096c2498.js" defer=""></script><script src="/_next/static/qUI0zfoHypOM71O3eM_zV/_buildManifest.js" defer=""></script><script src="/_next/static/qUI0zfoHypOM71O3eM_zV/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap">@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col md:flex-row font-sans text-xl w-full"><aside class="md:max-w-[360px] bg-primary px-10 py-10 text-white text-xl md:fixed md:top-0 md:left-0 md:h-full flex flex-col justify-end items-center md:items-start"><div><a href="/"><div class="mb-5"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27200%27%20height=%27200%27/%3e"/></span><img alt="profile picture" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="profile picture" src="/img/profile.webp" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="rounded-full" loading="lazy"/></noscript></span></div><h1 class="text-white font-bold text-4xl leading-10">David Saltares</h1></a></div><p class="text-contentLight text-2xl mb-5 leading-9 text-center md:text-left">Engineering Leadership &amp; Software Development</p><a href="https://tinyletter.com/dsaltares/"><p class="mb-5">✉️ Subscribe</p></a><nav><ul class="mb-5 flex flex-col items-center md:items-start list-none pl-0"><li class="leading-7"><a href="/">Blog</a></li><li class="leading-7"><a href="/about-me">About</a></li><li class="leading-7"><a href="/apps-tools">Apps &amp; Tools</a></li><li class="leading-7"><a href="/game-jams">Game Jams</a></li><li class="leading-7"><a href="/games">Games</a></li><li class="leading-7"><a href="/libgdx-cross-platform-game-development-cookbook">Libgdx Cookbook</a></li></ul></nav><ul class="mb-5 list-none pl-0"><li class="inline"><a aria-label="Github profile" href="https://github.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-github" class="svg-inline--fa fa-square-github text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></li><li class="inline"><a aria-label="Linkedin profile" href="https://www.linkedin.com/in/davidsaltares/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="inline"><a aria-label="Twitter profile" href="https://twitter.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-twitter" class="svg-inline--fa fa-square-twitter text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg></a></li><li class="inline"><a aria-label="RSS feed" href="https://saltares.com/index.xml"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path></svg></a></li></ul><p class="text-contentLight text-lg">© 2022 David Saltares.</p></aside><div class="md:max-w-[360px] w-full hidden md:block"></div><div class="w-full pr-4 py-10 pl-5 md:py-20 md:pl-20"><main class="w-full max-w-[720px]"><article class="text-content mb-10"><div><a href="/migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel"><h1 class="font-bold text-4xl mb-2 text-primary">Migrating Teamfindr from CRA+Express+AWS to Next.js+Vercel</h1></a><p class="flex text-contentLight mb-1">Aug 16 2022 · 5 min read<span> · </span><a class="text-contentLink" href="/migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel#disqus_thread">Comments</a></p><div class="mb-3"><div class="flex flex-row gap-1"><a class="px-2 py-1 bg-slate-900 text-white rounded font-bold text-sm" href="/categories/development">Development</a></div></div></div><p><img class="mb-1" src="/img/teamfindr/teamfindr_00001.webp" alt="TeamFindr header banner"/>
<a class="text-contentLink text-xl" href="https://teamfindr.saltares.com/">TeamFindr</a> is a mobile-first web application that helps you find nearby pick-up games, organise games with your friends and find extra players. My friend <a class="text-contentLink text-xl" href="https://www.linkedin.com/in/cristian-iordan-26b1abb7/">Cristi</a> and I built it during the pandemic. Back then, I used <a class="text-contentLink text-xl" href="https://create-react-app.dev/">CRA</a> for the client and <a class="text-contentLink text-xl" href="https://expressjs.com/">Express</a> for the REST API. The client was deployed to <a class="text-contentLink text-xl" href="https://create-react-app.dev/docs/deployment/#github-pages">Github pages</a> and the server to an <a class="text-contentLink text-xl" href="https://github.com/dsaltares/teamfindr/blob/784c972d5e2bd1e7cd3d213c462d8a1cc0839485/.github/workflows/lint_test_and_deploy.yaml#L75-L108">EC2 machine on AWS via Docker</a>. The whole thing is <a class="text-contentLink text-xl" href="https://github.com/dsaltares/teamfindr">open source</a>.</p>
<p>Recently, I migrated TeamFindr to <a class="text-contentLink text-xl" href="https://nextjs.org/">Next.js</a> and deployed it to <a class="text-contentLink text-xl" href="https://vercel.com/">Vercel</a>. In this article, I go over the reasons for the change, the actual migration process and some comparative metrics.</p>
<h2>🤔 Reasons to migrate</h2>
<p>What prompted me to migrate was that the EC2 free tier in my AWS account expired. My <code class="text-code bg-codeBg px-2 py-1 text-base rounded">t2.micro</code> instance was ~$10/month, and Vercel&#x27;s free tier limits are more than enough to keep TeamFindr online. My rule is that side projects must remain free to run 😅.</p>
<p>There were other reasons as well.</p>
<ul>
<li>⛰️ Next.js and Vercel support <a class="text-contentLink text-xl" href="https://nextjs.org/docs/api-routes/introduction">API routes</a>, which allows me to keep both client and API in the same deployment unit.</li>
<li>🎉 A single codebase means sharing typescript types between client and API is more manageable without the need for complex monorepo setups like yarn workspaces.</li>
<li>🔥 Vercel offers zero-config deployments and eliminates a bunch of technologies from my project. Just Vercel now replaces Docker, ECR, Nginx and EC2. Fewer tools and less config mean easier reproducibility.</li>
<li>🔒 There is no vendor lock-in because one can quickly <a class="text-contentLink text-xl" href="https://blog.logrocket.com/deploying-nextjs-aws-serverless-next-js/#features">deploy Next.js apps elsewhere</a>.</li>
<li>🏎️ Next.js developer experience is better, and you get other niceties like automatic code splitting and optimised images.</li>
</ul>
<h2>🦜 The migration process</h2>
<p>Overall, it was a smooth ride that only took a couple of days from start to shipping.</p>
<p>The first step was to port the <strong>client</strong> from CRA to Next.js. The original application was a client-rendered <a class="text-contentLink text-xl" href="https://developer.mozilla.org/en-US/docs/Glossary/SPA">SPA</a>, and I kept it that way for several reasons.</p>
<ul>
<li>The entire package assumed it runs on the client. The app uses <code class="text-code bg-codeBg px-2 py-1 text-base rounded">window</code> and other browser APIs such as <a class="text-contentLink text-xl" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API"><code class="text-code bg-codeBg px-2 py-1 text-base rounded">navigator.geolocation</code></a>.</li>
<li>I didn&#x27;t have to bother migrating away from <a class="text-contentLink text-xl" href="https://reactrouter.com/"><code class="text-code bg-codeBg px-2 py-1 text-base rounded">react-router</code></a> to Next.js&#x27;s router.</li>
<li>The old app used <a class="text-contentLink text-xl" href="https://v5.reactrouter.com/web/api/HashRouter"><code class="text-code bg-codeBg px-2 py-1 text-base rounded">HashRouter</code></a>. Switching to regular routing would mean breaking links such as <a class="text-contentLink text-xl" href="https://teamfindr.saltares.com/#/venues/8d37b22c-6563-4723-a97c-a5fcc0747695"><code class="text-code bg-codeBg px-2 py-1 text-base rounded">https://teamfindr.saltares.com/#/venues/8d37b22c-6563-4723-a97c-a5fcc0747695</code></a>.</li>
</ul>
<p>I followed the Next.js docs to <a class="text-contentLink text-xl" href="https://nextjs.org/docs/migrating/from-create-react-app">migrate from a CRA</a>, particularly <a class="text-contentLink text-xl" href="https://nextjs.org/docs/migrating/from-create-react-app#single-page-app-spa">the SPA section</a>. At that point, I had a Next.js-powered frontend that talked to my old Express API. To test components in isolation, I used <a class="text-contentLink text-xl" href="https://storybook.js.org/">Storybook</a>, so I followed their official <a class="text-contentLink text-xl" href="https://storybook.js.org/blog/get-started-with-storybook-and-next-js/">guide to set it up in Next.js</a>, and all my old stories worked perfectly.</p>
<p>Migrating the <strong>API</strong> was slightly trickier, especially getting <a class="text-contentLink text-xl" href="https://www.passportjs.org/">passport</a> authentication to work. My Express server relied on a bunch of middleware: <code class="text-code bg-codeBg px-2 py-1 text-base rounded">passport</code>, <a class="text-contentLink text-xl" href="https://www.npmjs.com/package/cookie-session"><code class="text-code bg-codeBg px-2 py-1 text-base rounded">cookie-session</code></a>, <a class="text-contentLink text-xl" href="https://www.npmjs.com/package/cookie-parser"><code class="text-code bg-codeBg px-2 py-1 text-base rounded">cookie-parser</code></a>, logging, protected routes, etc.</p>
<p>Fortunately, I discovered <a class="text-contentLink text-xl" href="https://www.npmjs.com/package/next-connect">next-connect</a>, which you can plug into your Next.js API routes and inject all your middleware. That made it super easy to keep middleware and endpoint handlers mostly as-is.</p>
<p>This is what my API routes look like.</p>
<div class="remark-highlight"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> getEvents<span class="token operator">:</span> <span class="token function-variable function">Handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token punctuation">,</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> events <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">searchEvents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    query<span class="token operator">:</span> <span class="token function">parseSearchEventsQuery</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span>
    userId<span class="token operator">:</span> user<span class="token operator">?.</span>id <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    body<span class="token operator">:</span> <span class="token punctuation">{</span> events <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&#x27;get&#x27;</span><span class="token punctuation">,</span>
    handler<span class="token operator">:</span> getEvents<span class="token punctuation">,</span>
    requiresAuth<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>And here&#x27;s part of my <code class="text-code bg-codeBg px-2 py-1 text-base rounded">createRoute</code> function.</p>
<div class="remark-highlight"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">createRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span>endpoints<span class="token operator">:</span> <span class="token maybe-class-name">EndpointDefinition</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token spread operator">...</span>

  <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      origin<span class="token operator">:</span> <span class="token maybe-class-name">Config</span><span class="token punctuation">.</span><span class="token property-access">hostUrl</span><span class="token punctuation">,</span>
      methods<span class="token operator">:</span> <span class="token string">&#x27;GET,HEAD,PUT,PATCH,POST,DELETE&#x27;</span><span class="token punctuation">,</span>
      credentials<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cookieSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#x27;session&#x27;</span><span class="token punctuation">,</span>
      keys<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Config</span><span class="token punctuation">.</span><span class="token property-access">authentication</span><span class="token punctuation">.</span><span class="token property-access">cookieKey</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      maxAge<span class="token operator">:</span> <span class="token number">365</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 1 year</span>
      overwrite<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token method function property-access">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token method function property-access">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>withRenewSession<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>withRequestLogger<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>withAuthenticatedUser<span class="token punctuation">)</span><span class="token punctuation">;</span>

  endpoints<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">[</span>endpoint<span class="token punctuation">.</span><span class="token property-access">method</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token function">createRawHandler</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">.</span><span class="token property-access">handler</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> router<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>As an aside, <a class="text-contentLink text-xl" href="https://next-auth.js.org/">NextAuth</a> makes it far easier to get authentication in a Next.js app. I would totally use it if I were to build the app from scratch.</p>
<p>At last, I could point the client to talk to the new Next.js API routes.</p>
<p><strong>Shipping</strong> was the easiest part.</p>
<ol>
<li>Merge to the <code class="text-code bg-codeBg px-2 py-1 text-base rounded">main</code> branch.</li>
<li>Configure a new app in Vercel and get it deployed.</li>
<li>Make the <code class="text-code bg-codeBg px-2 py-1 text-base rounded">teamfindr.saltares.com</code> domain point at Vercel.</li>
<li>Delete the EC2 instance in AWS.</li>
<li>Save $10/month 🤑😅.</li>
</ol>
<h2>📈 Before and after</h2>
<p>TeamFindr has 18% less code and deploys 54% faster as a Next.js app running on Vercel than a CRA+Express app on EC2. The REST API response times are mostly unchanged except for cold starts. When you hit a cold route, response times may <a class="text-contentLink text-xl" href="https://aws.amazon.com/blogs/compute/operating-lambda-performance-optimization-part-1/#:~:text=According%20to%20an%20analysis%20of,ms%20to%20over%201%20second.">increase by between 100 and 1000ms</a>. Given the performance requirements of TeamFindr, I would say this is a fair tradeoff, and the benefits far outweigh the compromises.</p>
<table><thead><tr><th>Metric</th><th>Before</th><th>After</th><th>Change</th></tr></thead><tbody><tr><td>Lines of code</td><td>12663</td><td>10414</td><td>-18%</td></tr><tr><td>Deployment times</td><td>~5m30s</td><td>~2m30s</td><td>-54%</td></tr><tr><td>API response times (average)</td><td>~80-200ms</td><td>~80-300ms</td><td>Negligible</td></tr></tbody></table>
<p>🙌 Thanks for reading. I hope you find my experience migrating a CRA app to Next.js helpful.</p></article></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"path":"content/post/2022-08-16-migrating-teamfindr-from-cra-to-nextjs.mdx","title":"Migrating Teamfindr from CRA+Express+AWS to Next.js+Vercel","date":"2022-08-16T00:00:00.000Z","categories":["Development"],"series":null,"description":"TeamFindr is an app to organise games with friends. I migrated it from a CRA to a Next.js app. In this post, I cover why, the process and some resulting metrics.","slug":"migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel","readingTime":"5 min read","draft":false,"disableComments":false,"keywords":["TeamFindr","side project","CRA","create React app","Next.js","AWS","Vercel","React","EC2","Docker","software migration","performance","REST API"],"banner":"/img/teamfindr/teamfindr_00001.webp"},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    a: \"a\",\n    h2: \"h2\",\n    code: \"code\",\n    ul: \"ul\",\n    li: \"li\",\n    strong: \"strong\",\n    div: \"div\",\n    pre: \"pre\",\n    span: \"span\",\n    ol: \"ol\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [_jsx(_components.img, {\n        src: \"/img/teamfindr/teamfindr_00001.webp\",\n        alt: \"TeamFindr header banner\"\n      }), \"\\n\", _jsx(_components.a, {\n        href: \"https://teamfindr.saltares.com/\",\n        children: \"TeamFindr\"\n      }), \" is a mobile-first web application that helps you find nearby pick-up games, organise games with your friends and find extra players. My friend \", _jsx(_components.a, {\n        href: \"https://www.linkedin.com/in/cristian-iordan-26b1abb7/\",\n        children: \"Cristi\"\n      }), \" and I built it during the pandemic. Back then, I used \", _jsx(_components.a, {\n        href: \"https://create-react-app.dev/\",\n        children: \"CRA\"\n      }), \" for the client and \", _jsx(_components.a, {\n        href: \"https://expressjs.com/\",\n        children: \"Express\"\n      }), \" for the REST API. The client was deployed to \", _jsx(_components.a, {\n        href: \"https://create-react-app.dev/docs/deployment/#github-pages\",\n        children: \"Github pages\"\n      }), \" and the server to an \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/teamfindr/blob/784c972d5e2bd1e7cd3d213c462d8a1cc0839485/.github/workflows/lint_test_and_deploy.yaml#L75-L108\",\n        children: \"EC2 machine on AWS via Docker\"\n      }), \". The whole thing is \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/teamfindr\",\n        children: \"open source\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Recently, I migrated TeamFindr to \", _jsx(_components.a, {\n        href: \"https://nextjs.org/\",\n        children: \"Next.js\"\n      }), \" and deployed it to \", _jsx(_components.a, {\n        href: \"https://vercel.com/\",\n        children: \"Vercel\"\n      }), \". In this article, I go over the reasons for the change, the actual migration process and some comparative metrics.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"🤔 Reasons to migrate\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"What prompted me to migrate was that the EC2 free tier in my AWS account expired. My \", _jsx(_components.code, {\n        children: \"t2.micro\"\n      }), \" instance was ~$10/month, and Vercel's free tier limits are more than enough to keep TeamFindr online. My rule is that side projects must remain free to run 😅.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There were other reasons as well.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"⛰️ Next.js and Vercel support \", _jsx(_components.a, {\n          href: \"https://nextjs.org/docs/api-routes/introduction\",\n          children: \"API routes\"\n        }), \", which allows me to keep both client and API in the same deployment unit.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"🎉 A single codebase means sharing typescript types between client and API is more manageable without the need for complex monorepo setups like yarn workspaces.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"🔥 Vercel offers zero-config deployments and eliminates a bunch of technologies from my project. Just Vercel now replaces Docker, ECR, Nginx and EC2. Fewer tools and less config mean easier reproducibility.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"🔒 There is no vendor lock-in because one can quickly \", _jsx(_components.a, {\n          href: \"https://blog.logrocket.com/deploying-nextjs-aws-serverless-next-js/#features\",\n          children: \"deploy Next.js apps elsewhere\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"🏎️ Next.js developer experience is better, and you get other niceties like automatic code splitting and optimised images.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"🦜 The migration process\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Overall, it was a smooth ride that only took a couple of days from start to shipping.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The first step was to port the \", _jsx(_components.strong, {\n        children: \"client\"\n      }), \" from CRA to Next.js. The original application was a client-rendered \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Glossary/SPA\",\n        children: \"SPA\"\n      }), \", and I kept it that way for several reasons.\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"The entire package assumed it runs on the client. The app uses \", _jsx(_components.code, {\n          children: \"window\"\n        }), \" and other browser APIs such as \", _jsx(_components.a, {\n          href: \"https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API\",\n          children: _jsx(_components.code, {\n            children: \"navigator.geolocation\"\n          })\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"I didn't have to bother migrating away from \", _jsx(_components.a, {\n          href: \"https://reactrouter.com/\",\n          children: _jsx(_components.code, {\n            children: \"react-router\"\n          })\n        }), \" to Next.js's router.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"The old app used \", _jsx(_components.a, {\n          href: \"https://v5.reactrouter.com/web/api/HashRouter\",\n          children: _jsx(_components.code, {\n            children: \"HashRouter\"\n          })\n        }), \". Switching to regular routing would mean breaking links such as \", _jsx(_components.a, {\n          href: \"https://teamfindr.saltares.com/#/venues/8d37b22c-6563-4723-a97c-a5fcc0747695\",\n          children: _jsx(_components.code, {\n            children: \"https://teamfindr.saltares.com/#/venues/8d37b22c-6563-4723-a97c-a5fcc0747695\"\n          })\n        }), \".\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I followed the Next.js docs to \", _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/migrating/from-create-react-app\",\n        children: \"migrate from a CRA\"\n      }), \", particularly \", _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/migrating/from-create-react-app#single-page-app-spa\",\n        children: \"the SPA section\"\n      }), \". At that point, I had a Next.js-powered frontend that talked to my old Express API. To test components in isolation, I used \", _jsx(_components.a, {\n        href: \"https://storybook.js.org/\",\n        children: \"Storybook\"\n      }), \", so I followed their official \", _jsx(_components.a, {\n        href: \"https://storybook.js.org/blog/get-started-with-storybook-and-next-js/\",\n        children: \"guide to set it up in Next.js\"\n      }), \", and all my old stories worked perfectly.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Migrating the \", _jsx(_components.strong, {\n        children: \"API\"\n      }), \" was slightly trickier, especially getting \", _jsx(_components.a, {\n        href: \"https://www.passportjs.org/\",\n        children: \"passport\"\n      }), \" authentication to work. My Express server relied on a bunch of middleware: \", _jsx(_components.code, {\n        children: \"passport\"\n      }), \", \", _jsx(_components.a, {\n        href: \"https://www.npmjs.com/package/cookie-session\",\n        children: _jsx(_components.code, {\n          children: \"cookie-session\"\n        })\n      }), \", \", _jsx(_components.a, {\n        href: \"https://www.npmjs.com/package/cookie-parser\",\n        children: _jsx(_components.code, {\n          children: \"cookie-parser\"\n        })\n      }), \", logging, protected routes, etc.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Fortunately, I discovered \", _jsx(_components.a, {\n        href: \"https://www.npmjs.com/package/next-connect\",\n        children: \"next-connect\"\n      }), \", which you can plug into your Next.js API routes and inject all your middleware. That made it super easy to keep middleware and endpoint handlers mostly as-is.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is what my API routes look like.\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-tsx\",\n        children: _jsxs(_components.code, {\n          className: \"language-tsx\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" getEvents\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"Handler\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" query\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" user \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" events \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"searchEvents\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    query\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"parseSearchEventsQuery\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"query\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    userId\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" user\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?.\"\n          }), \"id \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"as\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"string\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    status\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"200\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    body\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" events \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"export\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"default\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"createRoute\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    method\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'get'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    handler\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" getEvents\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    requiresAuth\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"And here's part of my \", _jsx(_components.code, {\n        children: \"createRoute\"\n      }), \" function.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-tsx\",\n        children: _jsxs(_components.code, {\n          className: \"language-tsx\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"createRoute\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"endpoints\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"EndpointDefinition\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" router \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"connect\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"cors\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n      origin\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Config\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"hostUrl\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      methods\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'GET,HEAD,PUT,PATCH,POST,DELETE'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      credentials\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"cookieSession\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n      name\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'session'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      keys\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Config\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"authentication\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"cookieKey\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      maxAge\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"365\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"24\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1000\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// 1 year\"\n          }), \"\\n      overwrite\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"cookieParser\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"passport\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"initialize\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"passport\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"session\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"withRenewSession\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"withRequestLogger\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"withAuthenticatedUser\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n  endpoints\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"forEach\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"endpoint\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    router\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"endpoint\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"method\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"createRawHandler\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"endpoint\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"handler\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" router\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"As an aside, \", _jsx(_components.a, {\n        href: \"https://next-auth.js.org/\",\n        children: \"NextAuth\"\n      }), \" makes it far easier to get authentication in a Next.js app. I would totally use it if I were to build the app from scratch.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"At last, I could point the client to talk to the new Next.js API routes.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Shipping\"\n      }), \" was the easiest part.\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Merge to the \", _jsx(_components.code, {\n          children: \"main\"\n        }), \" branch.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Configure a new app in Vercel and get it deployed.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Make the \", _jsx(_components.code, {\n          children: \"teamfindr.saltares.com\"\n        }), \" domain point at Vercel.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Delete the EC2 instance in AWS.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Save $10/month 🤑😅.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"📈 Before and after\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"TeamFindr has 18% less code and deploys 54% faster as a Next.js app running on Vercel than a CRA+Express app on EC2. The REST API response times are mostly unchanged except for cold starts. When you hit a cold route, response times may \", _jsx(_components.a, {\n        href: \"https://aws.amazon.com/blogs/compute/operating-lambda-performance-optimization-part-1/#:~:text=According%20to%20an%20analysis%20of,ms%20to%20over%201%20second.\",\n        children: \"increase by between 100 and 1000ms\"\n      }), \". Given the performance requirements of TeamFindr, I would say this is a fair tradeoff, and the benefits far outweigh the compromises.\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Metric\"\n          }), _jsx(_components.th, {\n            children: \"Before\"\n          }), _jsx(_components.th, {\n            children: \"After\"\n          }), _jsx(_components.th, {\n            children: \"Change\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"Lines of code\"\n          }), _jsx(_components.td, {\n            children: \"12663\"\n          }), _jsx(_components.td, {\n            children: \"10414\"\n          }), _jsx(_components.td, {\n            children: \"-18%\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"Deployment times\"\n          }), _jsx(_components.td, {\n            children: \"~5m30s\"\n          }), _jsx(_components.td, {\n            children: \"~2m30s\"\n          }), _jsx(_components.td, {\n            children: \"-54%\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"API response times (average)\"\n          }), _jsx(_components.td, {\n            children: \"~80-200ms\"\n          }), _jsx(_components.td, {\n            children: \"~80-300ms\"\n          }), _jsx(_components.td, {\n            children: \"Negligible\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"🙌 Thanks for reading. I hope you find my experience migrating a CRA app to Next.js helpful.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","scope":{}},"series":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel"},"buildId":"qUI0zfoHypOM71O3eM_zV","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>