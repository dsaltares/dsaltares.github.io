<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Smart enums in C&#43;&#43; or: &#34;what is this madness?&#34; &middot; Engineering Leadership &amp; Software Development</title>

  
  <link rel="stylesheet" href="../../css/poole.css">
  <link rel="stylesheet" href="../../css/hyde.css">
  <link rel="stylesheet" href="../../css/poole-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-x.css">
  <link rel="stylesheet" href="../../css/highlight/zenburn.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../touch-icon-144-precomposed.png">
  <link href="../../img/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="I am David and I write about engineering leadership, remote teams, software development and games development.">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-4440744-3', 'auto');
    ga('send', 'pageview');
  </script>
  

  
  <link rel="canonical" href="https://saltares.com/computing/smart-enums-in-c-or-what-is-this-madness/" itemprop="url" />
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="../../"><img src="../../img/profile.jpg"
             alt="profile-picture" id="profile-img" title="David Saltares"></a>
      <h1><a href="../../">David Saltares</a></h1>
      <p class="lead">Engineering Leadership &amp; Software Development</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="../../">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="../../about">About</a></li>
      
      <li class="sidebar-nav-item"><a href="../../apps-tools">Apps &amp; Tools</a></li>
      
      <li class="sidebar-nav-item"><a href="../../game-jams">Game Jams</a></li>
      
      <li class="sidebar-nav-item"><a href="../../games">Games</a></li>
      
      <li class="sidebar-nav-item"><a href="../../libgdx-cross-platform-game-development-cookbook">Libgdx Cookbook</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a aria-label="Github profile" href="http://github.com/dsaltares"><i class="fa fa-github-square fa-2x"></i></a>
      
      
      <a aria-label="LinkedIn profile" href="https://www.linkedin.com/in/davidsaltares"><i class="fa fa-linkedin-square fa-2x"></i></a>
      
      
      <a aria-label="Twitter profile" href="http://twitter.com/d_saltares"><i class="fa fa-twitter-square fa-2x"></i></a>
      
      <a aria-label="RSS" href="../../index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-2x"></i></a>
      </li>
    </ul>

    

    <div class="copyright">
      <p>
        &copy; 2022 David Saltares.<br/>
        Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X.</a><br/>
        Hosted on <a href="https://pages.github.com/">Github Pages</a>.
      </p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Smart enums in C&#43;&#43; or: &#34;what is this madness?&#34;</h1>
    <span class="post-date">Feb 9, 2014 &middot; 4 minute read &middot; <a href="https://saltares.com/computing/smart-enums-in-c-or-what-is-this-madness/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="../../categories/computing">Computing</a>
    </span>
    <p>Needless to say, <strong>C++ is a glorious language</strong>. Sadly, the attention it gets on the blog is far from representative of my appreciation towards it. Despite it being my main language at work, I only tend to talk about <a href="../../tag/libgdx/">Libgdx</a> side projects around here. Well, enough is enough!</p>
<p>Truth be told, over the years, standard after standard, C++ has become a behemoth of a language. As <a href="https://www.google.co.uk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CC8QFjAA&amp;url=http%3A%2F%2Fwww.amazon.co.uk%2FEffective-Specific-Addison-Wesley-Professional-Computing%2Fdp%2F0201924889&amp;ei=T9X3UoS5Ec7y7AaS5IDQDA&amp;usg=AFQjCNFQ9GOAfduwPXXh4k9gzib3-djOTg&amp;sig2=JutKpkkTKO8YMXdtaGgZmA&amp;bvm=bv.60983673,d.ZGU">Scott Meyers</a> likes to say, it&rsquo;s actually a set of languages.</p>
<ul>
<li>C with classes.</li>
<li>C with classes and the STL.</li>
<li>All of the above and templates.</li>
</ul>
<p>One of the beauties of C++ is that I can always learn something new about it, which almost makes up for its ever growing syntax complexity.</p>
<h3 id="lets-talk-macros">Let&rsquo;s talk macros</h3>
<p>Let&rsquo;s talk about macros. Everyone knows about the <a href="www.cplusplus.com/doc/tutorial/preprocessor/">preprocessor</a> and the basic usage of macros, right?</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Actually, let&rsquo;s talk about macros that take other macros as arguments.</p>
<blockquote>
<p>Sorry what?</p>
</blockquote>
<h3 id="the-problem">The problem</h3>
<p>Let us imagine we define the following perfectly standard enum to represent kinds of animals in a farm.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Our application can request a server a list of animals a given farm has. The server sends the animal names as strings, so we need to convert them to enum values. Alright, let&rsquo;s define a function to do that.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Err… That is not the most elegant piece of code you&rsquo;ve ever seen, is it? We also might have to convert from an enum value to a string literal in case we want to send a report back to the server.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>That was horrendous enough, but just the thought of adding new species to the catalogue makes me shiver badly. Why not simply use strings to represent animal species? Enums are nice because they heavily reduce the domain of values a variable can have and prevent us from making silly typos everywhere.</p>
<blockquote>
<p>There must be a better solution.</p>
</blockquote>
<h3 id="higher-order-macros">Higher order macros</h3>
<p>To make things nicer, we&rsquo;d need some sort of compile time mechanism that traverses the list of enum values generating the time consuming boilerplate code for us.</p>
<blockquote>
<p>The preprocessor!</p>
</blockquote>
<p>Take a look at this way of defining our list of animals.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><code>_ANIMAL_LIST_</code> is a higher order macro that takes a macro m as a parameter. Then it passes each one of our animal species to m.</p>
<p>The previous macro is not really useful by itself. Let&rsquo;s make things slightly more interesting</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><code>SMARTENUM_DEFINE_ENUM</code> takes the enum name and the list of values as parameters and defines an enum for us. It also appends the total count.</p>
<!-- raw HTML omitted -->
<p>When we write</p>
<!-- raw HTML omitted -->
<p>The preprocessor expands it to</p>
<!-- raw HTML omitted -->
<p>Okay, that was a lot of gibber jabber for very little gain.</p>
<p>Hang on a minute, we can go further. Let&rsquo;s write a small mechanism to convert an enum value to a string literal.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><code>SMARTENUM_DEFINE_NAMES</code> takes an enum type and the list of values and generates an array with the string representations of our list values. Interestingly enough, the values in the array map directly to those of the enum. This allows us to write the third macro, which accesses the array at the right position to return the corresponding string literal for a given enum value.</p>
<!-- raw HTML omitted -->
<p>When we write</p>
<!-- raw HTML omitted -->
<p>The preprocessor expands it to</p>
<!-- raw HTML omitted -->
<p>So</p>
<!-- raw HTML omitted -->
<p>Will result in</p>
<!-- raw HTML omitted -->
<p>Aha!</p>
<p>Getting an enum value from a string literal is slightly trickier but still achievable. We&rsquo;ve come this far, so it&rsquo;d be a shame not to finish the job.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The first abomination generates a function that iterates over the previously defined array of names doing string comparisons until it finds the desired enum value. The second one is nothing more than a convenience macro to spare the user from remembering the preprocessor generated function name.</p>
<p>Now if we do</p>
<!-- raw HTML omitted -->
<p>We can simply go</p>
<!-- raw HTML omitted -->
<p>Neat, isn&rsquo;t it?</p>
<h3 id="for-future-references">For future references</h3>
<p>Now, every time we want to define an enum type that we need to convert to and from strings we&rsquo;ll be lucky to be able to do the following.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Voilà!</p>
<p>Admittedly, using macros like this doesn&rsquo;t make for readable code and sometimes results in debugging complications. However, I&rsquo;ve been able to debug my code normally in Visual Studio 2012 when using similar macros.</p>
<p>String conversion of enums is just the tip of the iceberg, this approach can be used to generate all sorts of repetitive boilerplate code.</p>
<h3 id="download-it">Download it</h3>
<p>In case you are interested, <a href="https://gist.github.com/dsaltares/8904478">SmartEnums.h</a> is available as a GitHub gist.</p>
<!-- raw HTML omitted -->

  </div>
  <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'siondream';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
<script src="../../js/load-photoswipe.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
</body>
</html>

