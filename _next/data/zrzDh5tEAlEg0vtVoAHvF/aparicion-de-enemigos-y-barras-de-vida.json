{"pageProps":{"metadata":{"path":"content/post/2011-06-04-aparicion-de-enemigos-y-barras-de-vida.mdx","title":"Aparición de enemigos y barras de vida","date":"2011-06-04T12:35:51.000Z","categories":["Games development"],"series":null,"description":null,"slug":"aparicion-de-enemigos-y-barras-de-vida","readingTime":"4 min read","draft":false,"disableComments":false,"keywords":[]},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    img: \"img\",\n    p: \"p\",\n    strong: \"strong\",\n    h3: \"h3\",\n    ul: \"ul\",\n    li: \"li\",\n    em: \"em\",\n    a: \"a\",\n    div: \"div\",\n    pre: \"pre\",\n    code: \"code\"\n  }, _provideComponents(), props.components), {YouTube} = _components;\n  if (!YouTube) _missingMdxReference(\"YouTube\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.img, {\n      src: \"/img/wp/titulo-enemyspawn.jpg\",\n      alt: \"titulo-enemyspawn.jpg\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Estos días he estado trabajando en la \", _jsx(_components.strong, {\n        children: \"carga de enemigos\"\n      }), \" dentro de Sion Tower y en las \", _jsx(_components.strong, {\n        children: \"barras de vida\"\n      }), \" que veis sobre sus cabezas. Tras algún que otro comedero de cabeza he acabado con un sistema bastante sencillo y que funciona exactamente como yo quería. En los siguientes párrafos explico cómo están diseñadas la aparición (spawn) de enemigos y las barras de vida para finalizar con un \", _jsx(_components.strong, {\n        children: \"vídeo del resultado\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Aparición de enemigos\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Como ya he mencionado en varias ocasiones, \", _jsx(_components.strong, {\n        children: \"Blender será el editor de niveles de Sion Tower\"\n      }), \". Desde esta potente herramienta definimos los objetos que componen el escenario, las zonas transitables por el enemigo (malla de navegación) y ahora los puntos y el momento en el que llegan las oleadas de enemigos. Todo esto se consigue gracias al formato de exportación DotScene y a una \", _jsx(_components.strong, {\n        children: \"convención de nombres\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"De la aparición\"\n      }), \" o spawn de un enemigo concreto \", _jsx(_components.strong, {\n        children: \"necesitamos conocer\"\n      }), \":\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Posición inicial.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Orientación inicial.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Tipo de enemigo.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Momento en el que aparece.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/blender-enemy.jpg\",\n      alt: \"blender-enemy.jpg\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"En Blender utilizamos una pequeñas pirámides horizontales para indicar la aparición de enemigos. Los dos primeros puntos ya los da la propia posición y orientación del objeto mientras que el resto lo conseguimos con el nombre del mismo. Los nombres tienen la estructura \", _jsx(_components.em, {\n        children: \"\\\"enemy.tipo.tiempo\\\"\"\n      }), \". Por ejemplo, un Goblin que aparezca en el segundo 1 se llamaría \", _jsx(_components.em, {\n        children: \"\\\"enemy.goblin.1\\\"\"\n      }), \" tal y como podéis ver en la siguiente figura.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/nombre-objeto-blender.png\",\n      alt: \"nombre-objeto-blender.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"La clase \", _jsx(_components.em, {\n        children: \"Level\"\n      }), \" guarda un vector de objetos \", _jsx(_components.em, {\n        children: \"EnemySpawn\"\n      }), \" que simplemente contienen la información de los cuatro puntos anteriores. El cada iteración de \", _jsx(_components.em, {\n        children: \"StateGame\"\n      }), \" se consulta si en el momento actual debería aparecer algún enemigo y en caso afirmativo se crea uno con las propiedades adecuadas.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Si colocamos los enemigos en el centro del escenario aparecerán súbitamente (como se muestra en el vídeo). Lo ideal es colocarlos en las puertas y que ellos mismos se desplacen para atacar al protagonista.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Barra de vida\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsxs(_components.strong, {\n        children: [\"Las barras de vida son \", _jsx(_components.a, {\n          href: \"http://www.ogre3d.org/docs/api/html/classOgre_1_1Billboard.html\",\n          children: \"Billboards\"\n        })]\n      }), \" de Ogre, rectángulos que se colocan en el espacio 3D de la escena que siempre permanecen de frente hacia la cámara. En este caso les asignamos un material con \", _jsx(_components.strong, {\n        children: \"una sencilla textura que cuenta con las dos partes\"\n      }), \" de la vida: la roja y la verde. La idea es que según el porcentaje de energía que le reste al enemigo, seleccionemos una porción de dicha textura utilizando las coordenadas UV. En el siguiente diagrama se ilustra el sencillo mecanismo.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/wp/barra-de-vida.png\",\n      alt: \"barra-de-vida.png\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Al no haber usado Billboards con anterioridad, este fue el paso que más tiempo me llevó. La ignorancia es terrible porque al final no era nada complicado, en la clase \", _jsx(_components.em, {\n        children: \"Enemy\"\n      }), \" tenemos los siguientes atributos.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"class Enemy: public Actor {\\n    ...\\n\\n    private:\\n        Ogre::BillboardSet* _bbSetLife;\\n        Ogre::Billboard* _lifeBar;\\n        Ogre::SceneNode* _lifeNode;\\n};\"\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Para crear la barra de vida simplemente tenemos el método \", _jsx(_components.em, {\n        children: \"createLifeBar\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"void Enemy::createLifeBar() {\\n    _bbSetLife = _sceneManager-&gt;createBillboardSet();\\n    _bbSetLife-&gt;setMaterialName(&quot;lifeBar&quot;);\\n    _lifeBar = _bbSetLife-&gt;createBillboard(Ogre::Vector3(0, 1.6, 0));\\n    _lifeBar-&gt;setDimensions(1, 0.1);\\n    _lifeBar-&gt;setTexcoordRect(0.0f, 0.0f, 0.5f, 1.0f);\\n\\n    _lifeNode = _node-&gt;createChildSceneNode();\\n\\n    _lifeNode-&gt;attachObject(_bbSetLife);\\n}\"\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"El material \", _jsx(_components.em, {\n        children: \"\\\"lifeBar\\\"\"\n      }), \" no podía ser más sencillo:\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"material lifeBar\\n{\\n\\ttechnique\\n\\t{\\n\\t\\tpass\\n\\t\\t{\\n\\t\\t\\temissive 0.7 0.7 0.7 1.0\\n\\n\\t\\t\\ttexture_unit\\n\\t\\t\\t{\\n\\t\\t\\t\\ttexture life.png\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n}\"\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"En cada iteración o cuando el enemigo sea herido hemos de llamar a \", _jsx(_components.em, {\n        children: \"updateLifeBar\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"void Enemy::updateLifeBar() {\\n    Ogre::Real ratio = _energy / _maxEnergy;\\n\\n    if (ratio &lt; 0.0f)\\n        ratio = 0.0f;\\n\\n    Ogre::Real u1 = (1.0f - ratio) / 2.0f;\\n    Ogre::Real v1 = 0.0f;\\n    Ogre::Real u2 = 0.5f + (1.0f - ratio) / 2.0f;\\n    Ogre::Real v2 = 1.0f;\\n\\n    _lifeBar-&gt;setTexcoordRect(u1, v1, u2, v2);\\n}\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Vídeo\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"En el siguiente vídeo se muestra el sistema de spawn de enemigos junto a sus barras de vida. Todo esto es \", _jsx(_components.em, {\n        children: \"\\\"work in progress\\\"\"\n      }), \" y aún queda mucho espacio para la mejora. Se esperan cambios en las animaciones del personaje, añadir efectos de sonido, incluir la IA de los enemigos… Sean comprensivos.\"]\n    }), \"\\n\", _jsx(YouTube, {\n      videoId: \"Pt3-Xf-n1KA\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","scope":{}},"series":null},"__N_SSG":true}