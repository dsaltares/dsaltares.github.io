{"pageProps":{"metadata":{"path":"content/post/2022-08-16-migrating-teamfindr-from-cra-to-nextjs.mdx","title":"Migrating Teamfindr from CRA+Express+AWS to Next.js+Vercel","date":"2022-08-16T00:00:00.000Z","categories":["Development"],"series":null,"description":"TeamFindr¬†is an app to organise games with friends. I migrated it from a CRA to a Next.js app. In this post, I cover why, the process and some resulting metrics.","slug":"migrating-teamfindr-from-cra-express-aws-to-nextjs-vercel","readingTime":"5 min read","draft":false,"disableComments":false,"keywords":["TeamFindr","side project","CRA","create React app","Next.js","AWS","Vercel","React","EC2","Docker","software migration","performance","REST API"],"banner":"/img/teamfindr/teamfindr_00001.png"},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    img: \"img\",\n    a: \"a\",\n    h2: \"h2\",\n    code: \"code\",\n    ul: \"ul\",\n    li: \"li\",\n    strong: \"strong\",\n    div: \"div\",\n    pre: \"pre\",\n    span: \"span\",\n    ol: \"ol\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [_jsx(_components.img, {\n        src: \"/img/teamfindr/teamfindr_00001.webp\",\n        alt: \"TeamFindr header banner\"\n      }), \"\\n\", _jsx(_components.a, {\n        href: \"https://teamfindr.saltares.com/\",\n        children: \"TeamFindr\"\n      }), \"¬†is a mobile-first web application that helps you find nearby pick-up games, organise games with your friends and find extra players. My friend \", _jsx(_components.a, {\n        href: \"https://www.linkedin.com/in/cristian-iordan-26b1abb7/\",\n        children: \"Cristi\"\n      }), \" and I built it during the pandemic. Back then, I used \", _jsx(_components.a, {\n        href: \"https://create-react-app.dev/\",\n        children: \"CRA\"\n      }), \" for the client and \", _jsx(_components.a, {\n        href: \"https://expressjs.com/\",\n        children: \"Express\"\n      }), \" for the REST API. The client was deployed to \", _jsx(_components.a, {\n        href: \"https://create-react-app.dev/docs/deployment/#github-pages\",\n        children: \"Github pages\"\n      }), \" and the server to an \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/teamfindr/blob/784c972d5e2bd1e7cd3d213c462d8a1cc0839485/.github/workflows/lint_test_and_deploy.yaml#L75-L108\",\n        children: \"EC2 machine on AWS via Docker\"\n      }), \". The whole thing is \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/teamfindr\",\n        children: \"open source\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Recently, I migrated TeamFindr to \", _jsx(_components.a, {\n        href: \"https://nextjs.org/\",\n        children: \"Next.js\"\n      }), \" and deployed it to \", _jsx(_components.a, {\n        href: \"https://vercel.com/\",\n        children: \"Vercel\"\n      }), \". In this article, I go over the reasons for the change, the actual migration process and some comparative metrics.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ü§î¬†Reasons to migrate\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"What prompted me to migrate was that the EC2 free tier in my AWS account expired. My \", _jsx(_components.code, {\n        children: \"t2.micro\"\n      }), \" instance was ~$10/month, and Vercel's free tier limits are more than enough to keep TeamFindr online. My rule is that side projects must remain free to run üòÖ.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"There were other reasons as well.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"‚õ∞Ô∏è¬†Next.js and Vercel support \", _jsx(_components.a, {\n          href: \"https://nextjs.org/docs/api-routes/introduction\",\n          children: \"API routes\"\n        }), \", which allows me to keep both client and API in the same deployment unit.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"üéâ¬†A single codebase means sharing typescript types between client and API is more manageable without the need for complex monorepo setups like yarn workspaces.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"üî•¬†Vercel offers zero-config deployments and eliminates a bunch of technologies from my project. Just Vercel now replaces Docker, ECR, Nginx and EC2. Fewer tools and less config mean easier reproducibility.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"üîí¬†There is no vendor lock-in because one can quickly \", _jsx(_components.a, {\n          href: \"https://blog.logrocket.com/deploying-nextjs-aws-serverless-next-js/#features\",\n          children: \"deploy Next.js apps elsewhere\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"üèéÔ∏è¬†Next.js developer experience is better, and you get other niceties like automatic code splitting and optimised images.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"ü¶ú¬†The migration process\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Overall, it was a smooth ride that only took a couple of days from start to shipping.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The first step was to port the \", _jsx(_components.strong, {\n        children: \"client\"\n      }), \" from CRA to Next.js. The original application was a client-rendered \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Glossary/SPA\",\n        children: \"SPA\"\n      }), \", and I kept it that way for several reasons.\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"The entire package assumed it runs on the client. The app uses \", _jsx(_components.code, {\n          children: \"window\"\n        }), \" and other browser APIs such as \", _jsx(_components.a, {\n          href: \"https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API\",\n          children: _jsx(_components.code, {\n            children: \"navigator.geolocation\"\n          })\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"I didn't have to bother migrating away from \", _jsx(_components.a, {\n          href: \"https://reactrouter.com/\",\n          children: _jsx(_components.code, {\n            children: \"react-router\"\n          })\n        }), \" to Next.js's router.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"The old app used \", _jsx(_components.a, {\n          href: \"https://v5.reactrouter.com/web/api/HashRouter\",\n          children: _jsx(_components.code, {\n            children: \"HashRouter\"\n          })\n        }), \". Switching to regular routing would mean breaking links such as \", _jsx(_components.a, {\n          href: \"https://teamfindr.saltares.com/#/venues/8d37b22c-6563-4723-a97c-a5fcc0747695\",\n          children: _jsx(_components.code, {\n            children: \"https://teamfindr.saltares.com/#/venues/8d37b22c-6563-4723-a97c-a5fcc0747695\"\n          })\n        }), \".\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"I followed the Next.js docs to \", _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/migrating/from-create-react-app\",\n        children: \"migrate from a CRA\"\n      }), \", particularly \", _jsx(_components.a, {\n        href: \"https://nextjs.org/docs/migrating/from-create-react-app#single-page-app-spa\",\n        children: \"the SPA section\"\n      }), \". At that point, I had a Next.js-powered frontend that talked to my old Express API. To test components in isolation, I used \", _jsx(_components.a, {\n        href: \"https://storybook.js.org/\",\n        children: \"Storybook\"\n      }), \", so I followed their official \", _jsx(_components.a, {\n        href: \"https://storybook.js.org/blog/get-started-with-storybook-and-next-js/\",\n        children: \"guide to set it up in Next.js\"\n      }), \", and all my old stories worked perfectly.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Migrating the \", _jsx(_components.strong, {\n        children: \"API\"\n      }), \" was slightly trickier, especially getting \", _jsx(_components.a, {\n        href: \"https://www.passportjs.org/\",\n        children: \"passport\"\n      }), \" authentication to work. My Express server relied on a bunch of middleware: \", _jsx(_components.code, {\n        children: \"passport\"\n      }), \", \", _jsx(_components.a, {\n        href: \"https://www.npmjs.com/package/cookie-session\",\n        children: _jsx(_components.code, {\n          children: \"cookie-session\"\n        })\n      }), \", \", _jsx(_components.a, {\n        href: \"https://www.npmjs.com/package/cookie-parser\",\n        children: _jsx(_components.code, {\n          children: \"cookie-parser\"\n        })\n      }), \", logging, protected routes, etc.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Fortunately, I discovered \", _jsx(_components.a, {\n        href: \"https://www.npmjs.com/package/next-connect\",\n        children: \"next-connect\"\n      }), \", which you can plug into your Next.js API routes and inject all your middleware. That made it super easy to keep middleware and endpoint handlers mostly as-is.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This is what my API routes look like.\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-tsx\",\n        children: _jsxs(_components.code, {\n          className: \"language-tsx\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" getEvents\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"Handler\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"async\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" query\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" user \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" events \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"await\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"searchEvents\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    query\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"parseSearchEventsQuery\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"query\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    userId\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" user\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"?.\"\n          }), \"id \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"as\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token builtin\",\n            children: \"string\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    status\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"200\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    body\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" events \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"export\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"default\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"createRoute\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    method\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'get'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    handler\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" getEvents\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    requiresAuth\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"false\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"And here's part of my \", _jsx(_components.code, {\n        children: \"createRoute\"\n      }), \" function.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-tsx\",\n        children: _jsxs(_components.code, {\n          className: \"language-tsx\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function-variable function\",\n            children: \"createRoute\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"endpoints\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"EndpointDefinition\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"token spread operator\",\n            children: \"...\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" router \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"connect\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"cors\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n      origin\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Config\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"hostUrl\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      methods\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'GET,HEAD,PUT,PATCH,POST,DELETE'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      credentials\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"cookieSession\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n      name\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'session'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      keys\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"Config\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"authentication\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"cookieKey\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      maxAge\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"365\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"24\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1000\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// 1 year\"\n          }), \"\\n      overwrite\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token boolean\",\n            children: \"true\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"cookieParser\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"passport\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"initialize\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"passport\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"session\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"withRenewSession\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"withRequestLogger\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"use\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"withAuthenticatedUser\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n  endpoints\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"forEach\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"endpoint\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=>\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    router\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"endpoint\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"method\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"createRawHandler\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"endpoint\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"handler\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"return\"\n          }), \" router\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"As an aside, \", _jsx(_components.a, {\n        href: \"https://next-auth.js.org/\",\n        children: \"NextAuth\"\n      }), \" makes it far easier to get authentication in a Next.js app. I would totally use it if I were to build the app from scratch.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"At last, I could point the client to talk to the new Next.js API routes.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Shipping\"\n      }), \" was the easiest part.\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Merge to the \", _jsx(_components.code, {\n          children: \"main\"\n        }), \" branch.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Configure a new app in Vercel and get it deployed.\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Make the \", _jsx(_components.code, {\n          children: \"teamfindr.saltares.com\"\n        }), \" domain point at Vercel.\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Delete the EC2 instance in AWS.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Save $10/month ü§ëüòÖ.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"üìà¬†Before and after\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"TeamFindr has 18% less code and deploys 54% faster as a Next.js app running on Vercel than a CRA+Express app on EC2. The REST API response times are mostly unchanged except for cold starts. When you hit a cold route, response times may \", _jsx(_components.a, {\n        href: \"https://aws.amazon.com/blogs/compute/operating-lambda-performance-optimization-part-1/#:~:text=According%20to%20an%20analysis%20of,ms%20to%20over%201%20second.\",\n        children: \"increase by between 100 and 1000ms\"\n      }), \". Given the performance requirements of TeamFindr, I would say this is a fair tradeoff, and the benefits far outweigh the compromises.\"]\n    }), \"\\n\", _jsxs(_components.table, {\n      children: [_jsx(_components.thead, {\n        children: _jsxs(_components.tr, {\n          children: [_jsx(_components.th, {\n            children: \"Metric\"\n          }), _jsx(_components.th, {\n            children: \"Before\"\n          }), _jsx(_components.th, {\n            children: \"After\"\n          }), _jsx(_components.th, {\n            children: \"Change\"\n          })]\n        })\n      }), _jsxs(_components.tbody, {\n        children: [_jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"Lines of code\"\n          }), _jsx(_components.td, {\n            children: \"12663\"\n          }), _jsx(_components.td, {\n            children: \"10414\"\n          }), _jsx(_components.td, {\n            children: \"-18%\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"Deployment times\"\n          }), _jsx(_components.td, {\n            children: \"~5m30s\"\n          }), _jsx(_components.td, {\n            children: \"~2m30s\"\n          }), _jsx(_components.td, {\n            children: \"-54%\"\n          })]\n        }), _jsxs(_components.tr, {\n          children: [_jsx(_components.td, {\n            children: \"API response times (average)\"\n          }), _jsx(_components.td, {\n            children: \"~80-200ms\"\n          }), _jsx(_components.td, {\n            children: \"~80-300ms\"\n          }), _jsx(_components.td, {\n            children: \"Negligible\"\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"üôå¬†Thanks for reading. I hope you find my experience migrating a CRA app to Next.js helpful.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","scope":{}},"series":null},"__N_SSG":true}