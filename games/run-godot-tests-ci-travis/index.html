<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>

  <title>Run automated tests for your Godot game on CI &middot; David Saltares</title>

  
  <link rel="stylesheet" href="../../css/poole.css">
  <link rel="stylesheet" href="../../css/hyde.css">
  <link rel="stylesheet" href="../../css/poole-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-overrides.css">
  <link rel="stylesheet" href="../../css/hyde-x.css">
  <link rel="stylesheet" href="../../css/highlight/zenburn.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../touch-icon-144-precomposed.png">
  <link href="../../img/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-4440744-3', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="../../"><img src="../../img/profile.jpg"
             alt="profile-picture" id="profile-img" title="David Saltares"></a>
      <h1><a href="../../">David Saltares</a></h1>
      <p class="lead">Software Development</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="../../">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="../../about">About</a></li>
      
      <li class="sidebar-nav-item"><a href="../../apps-tools">Apps &amp; Tools</a></li>
      
      <li class="sidebar-nav-item"><a href="../../game-jams">Game Jams</a></li>
      
      <li class="sidebar-nav-item"><a href="../../games">Games</a></li>
      
      <li class="sidebar-nav-item"><a href="../../libgdx-cross-platform-game-development-cookbook">Libgdx Cookbook</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="http://github.com/dsaltares"><i class="fa fa-github-square fa-2x"></i></a>
      
      
      <a href="https://www.linkedin.com/in/davidsaltares"><i class="fa fa-linkedin-square fa-2x"></i></a>
      
      
      <a href="http://twitter.com/d_saltares"><i class="fa fa-twitter-square fa-2x"></i></a>
      <a href="https://www.youtube.com/channel/UCw375yUExJOVIEHmvmPFWyg"><i class="fa fa-youtube-square fa-2x"></i></a>
      <a href="../../index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-2x"></i></a>
      </li>
    </ul>

    

    <div class="copyright">
      <p>&copy; 2020 David Saltares.<br/>
         Powered by <a href="http://gohugo.io">Hugo</a>, <a href="https://pages.github.com/">Github Pages</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X.</a></p>
    </div>
  </div>
</div>

<div class="content container">
  <div class="post">
    <h1 class="post-title">Run automated tests for your Godot game on CI</h1>
    <span class="post-date">Nov 26, 2018 &middot; <a href="https://saltares.com/games/run-godot-tests-ci-travis/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="../../categories/games-development">Games development</a>
    </span>
    

<h3 id="automated-testing-in-gamedev">Automated testing in gamedev</h3>

<p>Nowadays, most people agree that automated testing is absolutely crucial for
all software development. Not so much <a href="https://saltares.com/games/thoughts-on-unit-testing-for-ashley-and-games-in-general/">when it comes to games development</a> though.
I still believe that the games industry would be able to iterate and ship faster by introducing unit and integration testing in the right places.</p>

<h3 id="godot-and-gut">Godot and Gut</h3>

<p><a href="https://github.com/bitwes">Butch Wesley</a> appears to be onboard, considering
he created <a href="https://github.com/bitwes/Gut">Gut</a>, an automated testing framework
for the <a href="https://godotengine.org/">Godot Game Engine</a>. Gut provides you with a collection of utilities to write and run tests for your game. Out of the box you get basic assertions, test doubles and even full node tree simulation.
Tests are run either from the Godot Editor or the command line using the godot executable itelf.</p>

<p>However, what good are automated tests if we <a href="https://softwareengineering.stackexchange.com/a/308517">exclusively rely on developers running
them locally</a>? The answer is: not very good at all.</p>

<h3 id="dead-simple-godot-ci-pipeline">Dead simple Godot CI pipeline</h3>

<p>That is why I experimented with running GDScript tests on a Continuous
Integration pipeline using the <a href="https://en.wikipedia.org/wiki/Headless_software">headless</a> Godot runtime. I created a repo
<a href="https://github.com/dsaltares/godot-ci-example">godot-ci-example</a> you can copy
to use on your own projects. Here is how it works.</p>

<p>Firstly, create a Godot project, install Gut from the Asset Library and enable it.
This is the same as what is explained in Gut&rsquo;s <a href="https://github.com/bitwes/Gut/wiki/Install">Install</a> and <a href="https://github.com/bitwes/Gut/wiki/Command-Line">Command Line</a> wiki pages.</p>

<p><img src="../../img/godot-ci/installing_gut.gif" alt="install-gut" /></p>

<p>Create a trivial test in <code>res://test/unit/test_example.gd</code>.</p>

<pre><code class="language-gdscript">extends &quot;res://addons/gut/test.gd&quot;

func test_assert_true_with_true():
	assert_true(true, &quot;Should pass, true is true&quot;)

</code></pre>

<p>You can now run these tests from the command line.</p>

<pre><code>godot -d -s --path ./project addons/gut/gut_cmdln.gd -gdir=res://test -ginclude_subdirs -gexit
</code></pre>

<p>Where <code>godot</code> is your Godot binary and <code>project</code> is the folder where your game lives.</p>

<p>Alright, we now have a basic test setup we can run locally. Let&rsquo;s move onto the meaty
part of the article, continuous integration. I&rsquo;ll be using
<a href="https://travis-ci.org/">Travis CI</a> because it&rsquo;s easy and free for open source projects hosted on Github, but knock yourself out with your CI system of choice.</p>

<p>Travis looks for a <code>.travis.yml</code> file in the root of your repo. This file tells Travis how to build the project and run tests. I recommend you take a quick look at the <a href="https://docs.travis-ci.com/user/tutorial/">docs</a>.</p>

<p>The <a href="https://github.com/dsaltares/godot-ci-example/blob/master/.travis.yml"><code>.travis.yml</code></a> file is trivial.</p>

<pre><code class="language-yaml">language: minimal
script: ./run_tests.sh
</code></pre>

<p>The <a href="https://github.com/dsaltares/godot-ci-example/blob/master/run_tests.sh"><code>run_tests.sh</code></a> script will download the headless Godot runtime and run the command we showed above. Make sure <code>run_tests.sh</code> has executable permissions.</p>

<pre><code class="language-bash">GODOT_VERSION=3.0.6
GODOT_BIN=Godot_v${GODOT_VERSION}-stable_linux_headless.64
GODOT_ZIP=${GODOT_BIN}.zip
GODOT_URL=https://downloads.tuxfamily.org/godotengine/${GODOT_VERSION}/${GODOT_ZIP}

curl ${GODOT_URL} --output ${GODOT_ZIP}
unzip ${GODOT_ZIP}
chmod +x ${GODOT_BIN}
./${GODOT_BIN} -d -s --path ./project addons/gut/gut_cmdln.gd -gdir=res://test -ginclude_subdirs -gexit
</code></pre>

<p>As you can see, it&rsquo;s also pretty easy to parameterize which Godot version you want
to use.</p>

<p>And that&rsquo;s it! You can get a cool &ldquo;Build passing&rdquo; badge for your repo. <a href="https://travis-ci.org/dsaltares/godot-ci-example">Here&rsquo;s what a typical build would look like</a>.</p>

<pre><code>/-----------------------------------------
Running Script res://test/unit/test_example.gd
-----------------------------------------/
* test_assert_true_with_true
*****************
Run Summary
*****************
***  Totals  ***
  scripts:          1
  tests:            1
  passing asserts:  1
  failing asserts:  0
  pending:          0
+++ 1 passed 0 failed.  Tests finished in:  0.0 +++
</code></pre>

<p>Happy testing!</p>

  </div>
  <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'siondream';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

