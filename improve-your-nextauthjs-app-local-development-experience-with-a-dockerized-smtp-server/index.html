<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/touch-icon-144-precomposed.png"/><title>Improve your NextAuth.js app local development experience with a dockerized SMTP server · David Saltares</title><meta name="robots" content="index,follow"/><meta name="description" content="Tutorial on how to improve your local development experience when using NextAuth.js by spinning up a MailHog SMTP server container."/><meta property="og:title" content="Improve your NextAuth.js app local development experience with a dockerized SMTP server · David Saltares"/><meta property="og:description" content="Tutorial on how to improve your local development experience when using NextAuth.js by spinning up a MailHog SMTP server container."/><meta property="og:url" content="https://saltares.com/improve-your-nextauthjs-app-local-development-experience-with-a-dockerized-smtp-server"/><meta property="og:type" content="website"/><link rel="canonical" href="https://saltares.com/improve-your-nextauthjs-app-local-development-experience-with-a-dockerized-smtp-server"/><meta name="keywords" content="local development,nextauth.js local development,mailhog testing SMTP server,docker SMTP server"/><meta name="next-head-count" content="12"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/d3d4cc303d9c1080.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/d3d4cc303d9c1080.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-7671224c423a1e1f.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-66d32731bdd20e83.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-41a9ee3ebe735abe.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-75760b031d352622.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/c16184b3-5eed107b4bbcea31.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/2cca2479-0d4bcd71a6a0316a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/252-2454d8293e83336b.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/167-6fe50976be6d0e53.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/962-ea29c7731d832d32.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/373-f5166c707bca4ed3.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-81b48131ea6e98cc.js" defer="" crossorigin=""></script><script src="/_next/static/4T_WFSip2e-4XXvcAbKcg/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/4T_WFSip2e-4XXvcAbKcg/_ssgManifest.js" defer="" crossorigin=""></script><style data-href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap">@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79P0Y.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh4Oo.woff) format('woff')}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0-ExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0aExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0yExcOPIDUg-g.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizaRExUiTo99u79D0KExcOPIDU.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OOtLR8a8zILig.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OqtLR8a8zILig.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0OCtLR8a8zILig.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'PT Sans';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/ptsans/v17/jizfRExUiTo99u79B_mh0O6tLR8a8zI.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="flex flex-col md:flex-row font-sans text-xl w-full"><aside class="md:max-w-[360px] bg-primary px-10 py-10 text-white text-xl md:fixed md:top-0 md:left-0 md:h-full flex flex-col justify-end items-center md:items-start"><div><a href="/"><div class="mb-5"><img alt="profile picture" loading="lazy" width="200" height="200" decoding="async" data-nimg="1" class="rounded-full" style="color:transparent" src="/img/profile.webp"/></div><h1 class="text-white font-bold text-4xl leading-10">David Saltares</h1></a></div><p class="text-contentLight text-2xl mb-5 leading-9 text-center md:text-left">Engineering Leadership &amp; Software Development</p><div class="mb-5 font-base"><button class="ml-onclick-form" onclick="ml('show', '646AL4', true)">✉️ Subscribe</button></div><nav><ul class="mb-5 flex flex-col items-center md:items-start list-none pl-0"><li class="leading-7"><a href="/">Blog</a></li><li class="leading-7"><a href="/about-me/">About</a></li><li class="leading-7"><a href="/apps-tools/">Apps &amp; Tools</a></li><li class="leading-7"><a href="/game-jams/">Game Jams</a></li><li class="leading-7"><a href="/games/">Games</a></li><li class="leading-7"><a href="/libgdx-cross-platform-game-development-cookbook/">Libgdx Cookbook</a></li></ul></nav><ul class="mb-5 list-none pl-0"><li class="inline"><a aria-label="Github profile" href="https://github.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-github" class="svg-inline--fa fa-square-github text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></li><li class="inline"><a aria-label="Linkedin profile" href="https://www.linkedin.com/in/davidsaltares/"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="inline"><a aria-label="Twitter profile" href="https://twitter.com/dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="square-twitter" class="svg-inline--fa fa-square-twitter text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg></a></li><li class="inline"><a aria-label="RSS feed" href="https://saltares.com/index.xml"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path></svg></a></li><li class="inline"><a rel="me" href="https://fosstodon.org/@dsaltares"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" class="svg-inline--fa fa-mastodon text-4xl mr-2" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></a></li></ul><p class="text-contentLight text-lg">© 2024 David Saltares.</p></aside><div class="md:max-w-[360px] w-full hidden md:block flex-grow-0 flex-shrink-0"></div><div class="flex flex-col main-content"><main class="w-full max-w-[720px] pr-4 py-10 pl-5 md:py-20 md:pl-20"><article class="text-content mb-10"><div><a href="/improve-your-nextauthjs-app-local-development-experience-with-a-dockerized-smtp-server/"><h1 class="font-bold text-4xl mb-2 text-primary">Improve your NextAuth.js app local development experience with a dockerized SMTP server</h1></a><p class="flex text-contentLight mb-1">Jan 16 2022 · 3 min read<span> · </span><a class="text-contentLink" href="/improve-your-nextauthjs-app-local-development-experience-with-a-dockerized-smtp-server/#disqus_thread">Comments</a></p><div class="mb-3"><div class="flex flex-row gap-1"><a class="px-2 py-1 bg-slate-900 text-white rounded font-bold text-sm" href="/categories/development/">Development</a></div></div></div><img class="mb-1" src="/img/nextjs/nextauth.webp" alt="NextAuth.js logo"/>
<p><a class="text-contentLink text-lg" href="https://next-auth.js.org/">NextAuth.js</a> makes it shockingly easy to add authentication to <a class="text-contentLink text-lg" href="https://nextjs.org/">Next.js</a> apps. It&#x27;s free, open source, it lets you own your data and it supports a ton of identity providers, including <a class="text-contentLink text-lg" href="https://en.wikipedia.org/wiki/One-time_password">one time passwords</a> or &quot;magic links&quot;.</p>
<p>Working with NextAuth.js is trivial, it sounds too good to be true!</p>
<p>Of course, there is a catch...</p>
<p>The developer experience worsens because you now need a network connection to log into your locally running app, even if your database is also local. Bye bye to chill sessions of working on the train.</p>
<p>You can fix that with a local SMTP server! Let&#x27;s see how we can set it up. I will be showing code samples, but you can find a full working example of this post <a class="text-contentLink text-lg" href="https://github.com/dsaltares/saltares-blog-examples/tree/main/nextauth-mailhog">here</a>.</p>
<h3>🔐 Set up NextAuth.js with the <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">EmailProvider</code></h3>
<p>Let&#x27;s assume you already have a Next.js application. If you don&#x27;t have NextAuth.js configured, the first thing is to follow the tutorial on their landing page. Then, set the <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">EmailProvider</code> in <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">/pages/api/auth/[...nextauth].js</code>.</p>
<div class="remark-highlight"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> NextAuth <span class="token keyword">from</span> <span class="token string">&#x27;next-auth&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> EmailProvider <span class="token keyword">from</span> <span class="token string">&#x27;next-auth/providers/email&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">EmailProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      server<span class="token operator">:</span> <span class="token punctuation">{</span>
        host<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_SERVER_HOST</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_SERVER_PORT</span><span class="token punctuation">,</span>
        auth<span class="token operator">:</span> <span class="token punctuation">{</span>
          user<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_SERVER_USER</span><span class="token punctuation">,</span>
          pass<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMAIL_SERVER_PASSWORD</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      from<span class="token operator">:</span> <span class="token string">&#x27;NextAuth &lt;noreply@example.com&gt;&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>For the <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">EmailProvider</code> to work, you also need to install the <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">nodemailer</code> package.</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">$ <span class="token function">yarn</span> <span class="token function">add</span> nodemailer
</code></pre></div>
<p>Remember that you also need to provide an <a class="text-contentLink text-lg" href="https://next-auth.js.org/adapters/overview">Adapter</a> to NextAuth.js so that it can persist data. In <a class="text-contentLink text-lg" href="https://github.com/dsaltares/saltares-blog-examples/blob/main/nextauth-mailhog/pages/api/auth/%5B...nextauth%5D.js#L9">my example</a>, I use the <a class="text-contentLink text-lg" href="https://next-auth.js.org/adapters/prisma"><code class="text-code bg-codeBg px-2 py-1 text-sm rounded">PrismaAdapter</code></a>.</p>
<h3>📬 Set up your local SMTP server</h3>
<p>We&#x27;re going to use <a class="text-contentLink text-lg" href="https://github.com/mailhog/MailHog">MailHog</a>, an open source email testing tool that comes with an SMTP server you can run locally. Conveniently, they have a zero config Docker image!</p>
<p>Create a <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">docker-compose.yaml</code> file or update your existing one and define the MailHog service.</p>
<p>Using Docker Compose to run your database locally is a pretty good idea! In my <a class="text-contentLink text-lg" href="https://github.com/dsaltares/saltares-blog-examples/tree/main/nextauth-mailhog">example repo</a> I went for a containerised PostgreSQL database.</p>
<div class="remark-highlight"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#x27;3.9&#x27;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mailhog</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mailhog/mailhog
    <span class="token key atrule">logging</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&#x27;none&#x27;</span> <span class="token comment"># disable saving logs</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 1025<span class="token punctuation">:</span><span class="token number">1025</span> <span class="token comment"># smtp server</span>
      <span class="token punctuation">-</span> 8025<span class="token punctuation">:</span><span class="token number">8025</span> <span class="token comment"># web ui</span>
</code></pre></div>
<p>Add a couple of convenience scripts to your <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">package.json</code>.</p>
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;docker:up&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker compose up -d&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;docker:down&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker compose down&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Edit your local <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">.env</code> file to configure the NextAuth.js <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">EmailProvider</code>. Leave everything as below.</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">EMAIL_SERVER_HOST=localhost
EMAIL_SERVER_PORT=1025
EMAIL_SERVER_USER=email-user
EMAIL_SERVER_PASSWORD=email-pass</code></pre></div>
<h3>💻 Local workflow</h3>
<p>Bring up your containers and start the local development server.</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">$ <span class="token function">yarn</span> docker:up <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> dev
</code></pre></div>
<p>Go to <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">https://localhost:3000</code>, click Sign in and enter your email.</p>
<img class="mb-1" src="/img/nextjs/nextauth-login.webp" alt="NextAuth.js login screen"/>
<p>Now you can open <code class="text-code bg-codeBg px-2 py-1 text-sm rounded">http://localhost:8025/</code> and see the email with the magic link.</p>
<img class="mb-1" src="/img/nextjs/mailhog.webp" alt="MailHog inbox"/>
<p>🎉 That&#x27;s it, you can now manage authentication in your app and work locally without an internet connection.</p></article></main></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"metadata":{"path":"content/post/2022-01-03-nextauth-mailhog-local-development.mdx","title":"Improve your NextAuth.js app local development experience with a dockerized SMTP server","date":"2022-01-16T00:00:00.000Z","categories":["Development"],"series":null,"description":"Tutorial on how to improve your local development experience when using NextAuth.js by spinning up a MailHog SMTP server container.","slug":"improve-your-nextauthjs-app-local-development-experience-with-a-dockerized-smtp-server","readingTime":"3 min read","draft":false,"disableComments":false,"keywords":["local development","nextauth.js local development","mailhog testing SMTP server","docker SMTP server"],"banner":null},"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    img: \"img\",\n    p: \"p\",\n    a: \"a\",\n    h3: \"h3\",\n    code: \"code\",\n    div: \"div\",\n    pre: \"pre\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.img, {\n      src: \"/img/nextjs/nextauth.webp\",\n      alt: \"NextAuth.js logo\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.a, {\n        href: \"https://next-auth.js.org/\",\n        children: \"NextAuth.js\"\n      }), \" makes it shockingly easy to add authentication to \", _jsx(_components.a, {\n        href: \"https://nextjs.org/\",\n        children: \"Next.js\"\n      }), \" apps. It's free, open source, it lets you own your data and it supports a ton of identity providers, including \", _jsx(_components.a, {\n        href: \"https://en.wikipedia.org/wiki/One-time_password\",\n        children: \"one time passwords\"\n      }), \" or \\\"magic links\\\".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Working with NextAuth.js is trivial, it sounds too good to be true!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Of course, there is a catch...\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The developer experience worsens because you now need a network connection to log into your locally running app, even if your database is also local. Bye bye to chill sessions of working on the train.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can fix that with a local SMTP server! Let's see how we can set it up. I will be showing code samples, but you can find a full working example of this post \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/saltares-blog-examples/tree/main/nextauth-mailhog\",\n        children: \"here\"\n      }), \".\"]\n    }), \"\\n\", _jsxs(_components.h3, {\n      children: [\"🔐 Set up NextAuth.js with the \", _jsx(_components.code, {\n        children: \"EmailProvider\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Let's assume you already have a Next.js application. If you don't have NextAuth.js configured, the first thing is to follow the tutorial on their landing page. Then, set the \", _jsx(_components.code, {\n        children: \"EmailProvider\"\n      }), \" in \", _jsx(_components.code, {\n        children: \"/pages/api/auth/[...nextauth].js\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-ts\",\n        children: _jsxs(_components.code, {\n          className: \"language-ts\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"import\"\n          }), \" NextAuth \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"from\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'next-auth'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"import\"\n          }), \" EmailProvider \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"from\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'next-auth/providers/email'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"export\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"default\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"NextAuth\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n  providers\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"EmailProvider\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n      server\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n        host\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" process\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"env\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"EMAIL_SERVER_HOST\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        port\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" process\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"env\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"EMAIL_SERVER_PORT\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        auth\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n          user\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" process\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"env\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"EMAIL_SERVER_USER\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n          pass\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" process\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"env\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"EMAIL_SERVER_PASSWORD\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n      from\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'NextAuth \u003cnoreply@example.com\u003e'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"For the \", _jsx(_components.code, {\n        children: \"EmailProvider\"\n      }), \" to work, you also need to install the \", _jsx(_components.code, {\n        children: \"nodemailer\"\n      }), \" package.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-bash\",\n        children: _jsxs(_components.code, {\n          className: \"language-bash\",\n          children: [\"$ \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"yarn\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"add\"\n          }), \" nodemailer\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Remember that you also need to provide an \", _jsx(_components.a, {\n        href: \"https://next-auth.js.org/adapters/overview\",\n        children: \"Adapter\"\n      }), \" to NextAuth.js so that it can persist data. In \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/saltares-blog-examples/blob/main/nextauth-mailhog/pages/api/auth/%5B...nextauth%5D.js#L9\",\n        children: \"my example\"\n      }), \", I use the \", _jsx(_components.a, {\n        href: \"https://next-auth.js.org/adapters/prisma\",\n        children: _jsx(_components.code, {\n          children: \"PrismaAdapter\"\n        })\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"📬 Set up your local SMTP server\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We're going to use \", _jsx(_components.a, {\n        href: \"https://github.com/mailhog/MailHog\",\n        children: \"MailHog\"\n      }), \", an open source email testing tool that comes with an SMTP server you can run locally. Conveniently, they have a zero config Docker image!\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Create a \", _jsx(_components.code, {\n        children: \"docker-compose.yaml\"\n      }), \" file or update your existing one and define the MailHog service.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Using Docker Compose to run your database locally is a pretty good idea! In my \", _jsx(_components.a, {\n        href: \"https://github.com/dsaltares/saltares-blog-examples/tree/main/nextauth-mailhog\",\n        children: \"example repo\"\n      }), \" I went for a containerised PostgreSQL database.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-yaml\",\n        children: _jsxs(_components.code, {\n          className: \"language-yaml\",\n          children: [_jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"version\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'3.9'\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"services\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"mailhog\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"image\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \" mailhog/mailhog\\n    \", _jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"logging\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"driver\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'none'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"# disable saving logs\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token key atrule\",\n            children: \"ports\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"-\"\n          }), \" 1025\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1025\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"# smtp server\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"-\"\n          }), \" 8025\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"8025\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"# web ui\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Add a couple of convenience scripts to your \", _jsx(_components.code, {\n        children: \"package.json\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-json\",\n        children: _jsxs(_components.code, {\n          className: \"language-json\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token property\",\n            children: \"\\\"scripts\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token property\",\n            children: \"\\\"docker:up\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"docker compose up -d\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"token property\",\n            children: \"\\\"docker:down\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"docker compose down\\\"\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Edit your local \", _jsx(_components.code, {\n        children: \".env\"\n      }), \" file to configure the NextAuth.js \", _jsx(_components.code, {\n        children: \"EmailProvider\"\n      }), \". Leave everything as below.\"]\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-unknown\",\n        children: _jsx(_components.code, {\n          className: \"language-unknown\",\n          children: \"EMAIL_SERVER_HOST=localhost\\nEMAIL_SERVER_PORT=1025\\nEMAIL_SERVER_USER=email-user\\nEMAIL_SERVER_PASSWORD=email-pass\"\n        })\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"💻 Local workflow\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Bring up your containers and start the local development server.\"\n    }), \"\\n\", _jsx(_components.div, {\n      className: \"remark-highlight\",\n      children: _jsx(_components.pre, {\n        className: \"language-bash\",\n        children: _jsxs(_components.code, {\n          className: \"language-bash\",\n          children: [\"$ \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"yarn\"\n          }), \" docker:up \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"\u0026\u0026\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"yarn\"\n          }), \" dev\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Go to \", _jsx(_components.code, {\n        children: \"https://localhost:3000\"\n      }), \", click Sign in and enter your email.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/nextjs/nextauth-login.webp\",\n      alt: \"NextAuth.js login screen\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now you can open \", _jsx(_components.code, {\n        children: \"http://localhost:8025/\"\n      }), \" and see the email with the magic link.\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/img/nextjs/mailhog.webp\",\n      alt: \"MailHog inbox\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"🎉 That's it, you can now manage authentication in your app and work locally without an internet connection.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","scope":{}},"series":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"improve-your-nextauthjs-app-local-development-experience-with-a-dockerized-smtp-server"},"buildId":"4T_WFSip2e-4XXvcAbKcg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>